<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon href=/fav.png type=image/png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="Led Ticker Tape"><meta property="og:description" content="Learn how to scroll text using .NET IoT and an LED panel"><meta property="og:type" content="article"><meta property="og:url" content="https://jimbobbennett.dev/blogs/led-ticker-tape/"><meta property="og:image" content="https://jimbobbennett.dev/blogs/led-ticker-tape/hello-lights.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2022-02-25T17:01:05+00:00"><meta property="article:modified_time" content="2022-02-25T17:01:05+00:00"><meta property="og:site_name" content="JimBobBennett"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jimbobbennett.dev/blogs/led-ticker-tape/hello-lights.png"><meta name=twitter:title content="Led Ticker Tape"><meta name=twitter:description content="Learn how to scroll text using .NET IoT and an LED panel"><meta name=twitter:site content="@jimbobbennett"><meta name=twitter:creator content="@jimbobbennett"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><link rel="shortcut icon" type=image/png href=/fav.png><link rel="shortcut icon" sizes=192x192 href=/fav.png><link rel=apple-touch-icon href=/fav.png><link rel=alternate type=application/rss+xml href=https://jimbobbennett.dev//index.xml title=JimBobBennett><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","dctc2ydykv")</script><script data-goatcounter=https://jimbobbennett.goatcounter.com/count async src=//gc.zgo.at/count.js></script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#000;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#000000;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{background-color:#000;font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content="Learn how to scroll text using .NET IoT and an LED panel"><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=/css/single.css><link rel=stylesheet href=/css/projects.css media=all><script defer src=/fontawesome-5/all-5.15.4.js></script><title>Led Ticker Tape | JimBobBennett</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
JimBobBennett
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/ aria-label=home>Home</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Recent Highlights</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/videos title=Videos>Videos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/podcasts title=Podcasts>Podcasts</a></li><li class="nav-item navbar-text"><a class=nav-link href=/livestreams title=Livestreams>Livestreams</a></li><li class="nav-item navbar-text"><a class=nav-link href=/conferences title=Conferences>Conferences</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul></div></div></nav></header><div id=content><section id=projects><div class="container pt-5" id=list-page><div class="row justify-content-center px-3 px-md-5"><h1 class="text-left pb-2 content">Led Ticker Tape</h1><div class="text-left content"><a href=https://linkedin.com/in/jimbobbennett>Jim Bennett
</a><small>|</small>
Feb 25, 2022</div></div></div></section><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><article class="page-content p-2"><p><img src=hello-lights.png alt="An LED panel showing Hello in green"></p><p>Anyone who knows me knows I&rsquo;m a big fan of IoT and LEDs. I love using IoT devices to control lights, from the LEDs behind my desk to <a href="https://www.youtube.com/watch?v=h5ETn4PTdQA">smart pumpkins</a>!</p><p>I&rsquo;ve been giving the .NET IoT libraries a spin for an upcoming project using a Raspberry Pi Zero W 2. I&rsquo;m usually a Python person when using a Pi, but the project I&rsquo;m working on needs a service that doesn&rsquo;t have Python libraries that run on a Pi. Instead it has a .NET library, so it was time to break out my C# skills for the first time in years.</p><p>I wanted to build an LED panel that can display text, either static text or scrolling text. So I picked up this <a href=https://amzn.to/3sVjF7M>WS2812B panel from Amazon (affiliate link)</a>, and started to dig into the .NET IoT libraries. WS2818b LEDs are also known as NeoPixels, and are addressable multicolor LEDs, so you can light up individual ones in any color you like. They are addressed based on the order they are connected to your device, so the first pixel in a string of LEDs is 0, the next is 1 and so on. You can add as many as you like, and the addresses just keep going up.</p><p>The .NET IoT libraries are on GitHub at <a href=https://github.com/dotnet/iot>github.com/dotnet/iot</a> and available as a NuGet. They support a wide range of boards including the Raspberry Pi.</p><h2 id=lighting-leds-in-c>Lighting LEDs in C#</h2><p>I started as I usually do with a clean install of Raspberry Pi OS Lite. I use the Lite version as I access my Pi remotely using VS Code for all my development. You can read more on how I do this on <a href=https://www.raspberrypi.com/news/coding-on-raspberry-pi-remotely-with-visual-studio-code/>my blog post on the Raspberry Pi blog</a>. When I connected to my Pi I installed .NET 6, and the C# extension in VS Code.</p><blockquote><p>One thing to note for the C# extension is it doesn&rsquo;t support remote debugging on the Pi Zero W 2.</p></blockquote><p>The .NET IoT libraries have a small amount of documentation and samples, so it wasn&rsquo;t too much effort to get the LEDs lighting up.</p><p>The .NET libraries control these pixels over SPI, so they need to be connected to an SPI pin and ground on the Pi, as well as to a 5V power supply. You can&rsquo;t use the 5V pins on the Pi as the panel can draw too much power and burn your Pi out, it&rsquo;s best to use an external 5V power supply, either from a USB connection or a power converter plugged into the mains.</p><p>You also need to do a bit of SPI configuration, and this is documented in the <a href=https://github.com/dotnet/iot/tree/main/src/devices/Ws28xx>GitHub source code for the WS2812B device code</a>.</p><blockquote><p>This is different to using the Adafruit NeoPixel libraries from Python, where you use different pins and don&rsquo;t need any SPI configuration.</p></blockquote><p>To use the .NET libraries, you start by creating an SPI configuration, then use that to create the pixels:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Create connection settings to connect to the panel using SPI</span>
</span></span><span style=display:flex><span>SpiConnectionSettings settings = <span style=color:#66d9ef>new</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    ClockFrequency = <span style=color:#ae81ff>2_400_000</span>,
</span></span><span style=display:flex><span>    Mode = SpiMode.Mode0,
</span></span><span style=display:flex><span>    DataBitLength = <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create an SPI device</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> spi = SpiDevice.Create(settings);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use the SPI device to connect to the LEDs</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// and pass the number of LEDs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> neoPixels = <span style=color:#66d9ef>new</span> Ws2812b(spi, <span style=color:#ae81ff>256</span>);
</span></span></code></pre></div><p>When you create the pixels, you pass in the length of the strip. I&rsquo;ve been using a 8x32 panel, which is actually a 256 pixel long strip arranged in and up/down pattern.</p><p>Once created, you light pixels by getting a <code>BitmapImage</code> from them, and setting colors on that. This image is a <code>length x 1</code> image, so 1 pixel tall, and as wide as the length of the LEDs. For example, my 8x32 panel is 256 pixels long, so is a bitmap of 256x1.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> img = neoPixels.Image;
</span></span></code></pre></div><p>You can then set pixels in this image to the color you want. The color is set using the <code>System.Drawing.Color</code> struct, which wraps ARGB values. The A (alpha channel) is ignored, so you set pixel brightness by reducing the value of the R, G, and B.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>img.SetPixel(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, Color.Red);
</span></span><span style=display:flex><span>img.SetPixel(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, Color.Green);
</span></span><span style=display:flex><span>img.SetPixel(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, Color.Blue);
</span></span></code></pre></div><p>Once the pixels are set in the image, it is committed and the LEDs updated.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>neoPixels.Update();
</span></span></code></pre></div><p>One quirk of the bitmaps, is you have to set all the pixels up to the last one you want set. So if you want to set pixel 10 to be red, you have to also set pixels 0-9 to something, even if it is <code>Color.Black</code> (off). The first pixel you set is mapped to the first LED in the strip, so if you just set pixels 10-20, then the strip is set as if the first LED was pixel 10.</p><p>For example, if you just want to set pixel 2 to blue, you can&rsquo;t do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> img = neoPixels.Image;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>img.SetPixel(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, Color.Blue);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>neoPixels.Update();
</span></span></code></pre></div><p>What will happen here is pixel 2 is the first one with a value, so that will be considered the first pixel in the strip, so the first LED will light up blue.
What you need to do is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> img = neoPixels.Image;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>img.SetPixel(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, Color.Black);
</span></span><span style=display:flex><span>img.SetPixel(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, Color.Black);
</span></span><span style=display:flex><span>img.SetPixel(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, Color.Blue);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>neoPixels.Update();
</span></span></code></pre></div><p>This will set the pixels 0 and 1 to off, and pixel 2 to blue.</p><h2 id=writing-text>Writing text</h2><p>I wanted to make my panel show text, either short static text, or scrolling text. The first thing I needed was a font - something that defines how to create letters from pixels. I found a similar project based on Arduino in a <a href=https://github.com/bigjosh/SimpleTickerTape/tree/main/fonts>GitHub project from Josh Levine</a> so leveraged this code for a font and re-wrote it in C#.</p><p>Next I needed the mapping code. These fonts are defined as columns of binary data, so the bits to set. Each character is 8 bits tall (the size of my panel), and 6 bits wide. This mapping code was a bit of fun as I not only needed to divide up my pixels into columns, and map from a pixel in the 1 dimensional strip to a character pixel, but the strips go up and down!</p><p>The way this panel is made is by weaving an LED strip up and down, so the pixels start at 0 on the top left, go down to 7 on the left-most column, then across one pixel to the right to 8, then up to 15.</p><p>This gives for the first few columns:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>15</span>   <span style=color:#ae81ff>16</span>   <span style=color:#ae81ff>31</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>   <span style=color:#ae81ff>14</span>   <span style=color:#ae81ff>17</span>   <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>   <span style=color:#ae81ff>13</span>   <span style=color:#ae81ff>18</span>   <span style=color:#ae81ff>29</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>12</span>   <span style=color:#ae81ff>19</span>   <span style=color:#ae81ff>28</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span>   <span style=color:#ae81ff>11</span>   <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>27</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span>   <span style=color:#ae81ff>10</span>   <span style=color:#ae81ff>21</span>   <span style=color:#ae81ff>26</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span>    <span style=color:#ae81ff>9</span>   <span style=color:#ae81ff>22</span>   <span style=color:#ae81ff>25</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>7</span>    <span style=color:#ae81ff>8</span>   <span style=color:#ae81ff>23</span>   <span style=color:#ae81ff>24</span>
</span></span></code></pre></div><p>This means that the mapping code needs to alternate - for 0dd numbered columns the pixels go down, for even numbered the pixels go up so the mapping has to be reversed!</p><p>I&rsquo;m not going to dive into all this mapping here, but you can find the code with full documentation in my <a href=https://github.com/jimbobbennett/NeoPixelTickerTape>NeoPixelTickerTape GitHub repo</a>.</p><p>I then added scrolling code that writes text starting at the right-most column, then re-writes it shifting left a column at a time.</p><p><img src=tickertape.gif alt="Hello world scrolling across the ticker tape"></p><h2 id=check-out-the-code>Check out the code</h2><p>You can find the code with full documentation in my <a href=https://github.com/jimbobbennett/NeoPixelTickerTape>NeoPixelTickerTape GitHub repo</a>.</p><p>You can also download a NuGet package to use in your apps:</p><p><img src="https://img.shields.io/nuget/v/JimBobBennett.NeoPixelTickerTape.svg?style=flat&amp;logo=nuget" alt="Select this to access the nuget"></p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#lighting-leds-in-c>Lighting LEDs in C#</a></li><li><a href=#writing-text>Writing text</a></li><li><a href=#check-out-the-code>Check out the code</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/led target=_blank>led</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/light target=_blank>light</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/dotnet target=_blank>dotnet</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/.net target=_blank>.net</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/iot target=_blank>iot</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://jimbobbennett.dev/blogs/led-ticker-tape/",this.page.identifier="8424ae186555adedc227aa127368260c"};(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://jimbobbennett.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2024 All Rights Reserved</div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js integrity=sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13 crossorigin=anonymous></script><script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script>function createCopyButton(e,t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy",n.addEventListener("click",()=>copyCodeToClipboard(n,e,t)),addCopyButtonToDom(n,e)}async function copyCodeToClipboard(e,t,n){const s=t.querySelector("pre > code").innerText;try{n.writeText(s)}finally{codeWasCopied(e)}}function codeWasCopied(e){e.blur(),e.innerText="Copied!",setTimeout(function(){e.innerText="Copy"},2e3)}function addCopyButtonToDom(e,t){t.insertBefore(e,t.firstChild);const n=document.createElement("div");n.className="highlight-wrapper",t.parentNode.insertBefore(n,t),n.appendChild(t)}if(navigator&&navigator.clipboard)document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,navigator.clipboard));else{var script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",script.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",script.crossOrigin="anonymous",script.onload=function(){addCopyButtons(clipboard)},document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,script)),document.body.appendChild(script)}</script></body></html>