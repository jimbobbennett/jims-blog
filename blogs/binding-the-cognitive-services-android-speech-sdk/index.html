<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon href=/fav.png type=image/png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="Binding the Cognitive Services Android Speech SDK - Part 1, binding the library"><meta property="og:description" content="As part of the Microsoft Cognitive Services speech API, there is a native Java Android SDK available as an .aar file. I wanted to use this in a Xamarin app, so I created a binding project for it.
The code for this is available in my GitHub.
Binding an SDK is a four step process:
Create the binding project with the relevant jar or aar file Make any necessary tweaks to the code or project to make it compile Make any required amendments to the code to make it into idiomatic C# Test it all out and fix up any issues There are some great docs available on the basics for doing this at docs."><meta property="og:type" content="article"><meta property="og:url" content="https://jimbobbennett.dev/blogs/binding-the-cognitive-services-android-speech-sdk/"><meta property="og:image" content="https://jimbobbennett.dev/blogs/binding-the-cognitive-services-android-speech-sdk/banner.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2018-09-09T14:55:00+00:00"><meta property="article:modified_time" content="2018-09-09T14:55:00+00:00"><meta property="og:site_name" content="JimBobBennett"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jimbobbennett.dev/blogs/binding-the-cognitive-services-android-speech-sdk/banner.png"><meta name=twitter:title content="Binding the Cognitive Services Android Speech SDK - Part 1, binding the library"><meta name=twitter:description content="As part of the Microsoft Cognitive Services speech API, there is a native Java Android SDK available as an .aar file. I wanted to use this in a Xamarin app, so I created a binding project for it.
The code for this is available in my GitHub.
Binding an SDK is a four step process:
Create the binding project with the relevant jar or aar file Make any necessary tweaks to the code or project to make it compile Make any required amendments to the code to make it into idiomatic C# Test it all out and fix up any issues There are some great docs available on the basics for doing this at docs."><meta name=twitter:site content="@jimbobbennett"><meta name=twitter:creator content="@jimbobbennett"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><link rel="shortcut icon" type=image/png href=/fav.png><link rel="shortcut icon" sizes=192x192 href=/fav.png><link rel=apple-touch-icon href=/fav.png><link rel=alternate type=application/rss+xml href=https://jimbobbennett.dev//index.xml title=JimBobBennett><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","dctc2ydykv")</script><script data-goatcounter=https://jimbobbennett.goatcounter.com/count async src=//gc.zgo.at/count.js></script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#000;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#000000;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{background-color:#000;font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=/css/single.css><link rel=stylesheet href=/css/projects.css media=all><script defer src=/fontawesome-5/all-5.15.4.js></script><title>Binding the Cognitive Services Android Speech SDK - Part 1, binding the library | JimBobBennett</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
JimBobBennett
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/ aria-label=home>Home</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Recent Highlights</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/videos title=Videos>Videos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/podcasts title=Podcasts>Podcasts</a></li><li class="nav-item navbar-text"><a class=nav-link href=/livestreams title=Livestreams>Livestreams</a></li><li class="nav-item navbar-text"><a class=nav-link href=/conferences title=Conferences>Conferences</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul></div></div></nav></header><div id=content><section id=projects><div class="container pt-5" id=list-page><div class="row justify-content-center px-3 px-md-5"><h1 class="text-left pb-2 content">Binding the Cognitive Services Android Speech SDK - Part 1, binding the library</h1><div class="text-left content"><a href=https://linkedin.com/in/jimbobbennett>Jim Bennett
</a><small>|</small>
Sep 9, 2018</div></div></div></section><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><article class="page-content p-2"><p>As part of the <a href="https://docs.microsoft.com/azure/cognitive-services/speech-service/?WT.mc_id=speech-blog-jabenn">Microsoft Cognitive Services speech API</a>, there is a native Java Android SDK available as an <code>.aar</code> file. I wanted to use this in a Xamarin app, so I created a binding project for it.</p><p>The code for this is available <a href=https://github.com/jimbobbennett/SpeechSdkXamarinSample>in my GitHub</a>.</p><p>Binding an SDK is a four step process:</p><ul><li>Create the binding project with the relevant <code>jar</code> or <code>aar</code> file</li><li>Make any necessary tweaks to the code or project to make it compile</li><li>Make any required amendments to the code to make it into idiomatic C#</li><li>Test it all out and fix up any issues</li></ul><p>There are some great docs available on the basics for doing this at <a href="https://docs.microsoft.com/xamarin/android/platform/binding-java-library/?WT.mc_id=speech-blog-jabenn">docs.microsoft.com</a>, but each library is different and can have it&rsquo;s own unique challenges so I thought I&rsquo;d write a few posts to highlight the steps I needed to take to bind the speech SDK.</p><p>In this first part, I&rsquo;ll show how to create a binding project, add the speech SDK <code>aar</code> file, and make everything compile. In the <a href=/blogs/binding-the-cognitive-services-android-speech-sdk-part-2-making-the-code-more-c-like>second part</a> I&rsquo;ll show how to make the code more idiomatic C#, then in the <a href=/blogs/binding-the-cognitive-services-android-speech-sdk-part-3-java-8-fun>third part</a> I&rsquo;ll show how to use it and fix up a nasty issue with the Android compiler and using jars created with the latest versions of Java.</p><h2 id=binding-the-sdk>Binding the SDK</h2><p>The first step was to create a binding project and add the <code>.aar</code> file. I followed the instructions in the <a href="https://docs.microsoft.com/xamarin/android/platform/binding-java-library/?WT.mc_id=speech-blog-jabenn">Xamarin docs</a>, creating a new Android binding project and adding the <code>client-sdk-0.6.0.aar</code> file to the <code>Jars</code> folder.</p><div class=image-div style=max-width:400px><p><img src=2018-09-09_12-31-54.png alt="A binding project with an aar file in the Jars folder"></p></div><p>When you compile this project, the compile step will generate code to bind every Java class it finds. Each class in the generated code is a wrapper for a Java class - it doesn&rsquo;t re-implement the Java code, it instead creates the same kind of thin wrapper that is used by the Xamarin Android SDK bindings. If you want to see this generated code, you can find it in the <code>obj/${Congfiguration}/generated/src</code> folder.</p><h2 id=making-it-work>Making it work</h2><p>After doing this, I compiled the library and hit a couple of compiler errors that I needed to fix up:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>/.../Com.Microsoft.Cognitiveservices.Speech.Internal.StdMapWStringWString.cs<span style=color:#f92672>(</span>72,72<span style=color:#f92672>)</span>: Error CS0738: <span style=color:#e6db74>&#39;StdMapWStringWString&#39;</span> does not implement interface member <span style=color:#e6db74>&#39;IIterable.Iterator()&#39;</span>. <span style=color:#e6db74>&#39;StdMapWStringWString.Iterator()&#39;</span> cannot implement <span style=color:#e6db74>&#39;IIterable.Iterator()&#39;</span> because it does not have the matching <span style=color:#66d9ef>return</span> type of <span style=color:#e6db74>&#39;IIterator&#39;</span>. <span style=color:#f92672>(</span>CS0738<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>Speech<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>/.../Com.Microsoft.Cognitiveservices.Speech.Internal.StdMapWStringWStringMapIterator.cs<span style=color:#f92672>(</span>83,83<span style=color:#f92672>)</span>: Error CS0738: <span style=color:#e6db74>&#39;StdMapWStringWStringMapIterator&#39;</span> does not implement interface member <span style=color:#e6db74>&#39;IIterator.Next()&#39;</span>. <span style=color:#e6db74>&#39;StdMapWStringWStringMapIterator.Next()&#39;</span> cannot implement <span style=color:#e6db74>&#39;IIterator.Next()&#39;</span> because it does not have the matching <span style=color:#66d9ef>return</span> type of <span style=color:#e6db74>&#39;Object&#39;</span>. <span style=color:#f92672>(</span>CS0738<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>Speech<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>The reason for this is that the Xamarin Java SDK doesn&rsquo;t contain the generic versions of <code>IIterator</code> and <code>IIterable</code> which are used by this library, instead it will default to using the non-generic versions, and the implementation of the generic interfaces doesn&rsquo;t match the signature of the non-generic version. So - how can it be fixed?</p><h3 id=metadataxml-and-additions>Metadata.xml and Additions</h3><p>Inside the binding project you can both alter the generated code and add new code.</p><ul><li><p><code>Transforms/Metadata.xml</code> - in this XML file you can alter the code that is generated. You can add entries to this file to remove some of the autogenerated code, either at class, method or property level. You can also change the generated code, for example changing the namespace - something especially useful to change from Java style namespaces to C# style.</p></li><li><p><code>Additions</code> - In this folder you can add code that is compiled into the final dll. Each autogenerated class is declared as <code>partial</code>, so not only can you add new classes and code, you can also add new parts to a generated class.</p></li></ul><h3 id=fixing-the-stdmapwstringwstring-code>Fixing the <code>StdMapWStringWString</code> code</h3><p>The <code>StdMapWStringWString</code> class implements a generic version of the <code>IIterable</code> interface - <code>IIterable&lt;StdMapWStringWStringMapIterator></code>. The Xamarin Java SDK doesn&rsquo;t contain the generic base interface, so the bound library defaults to implementing <code>IIterable</code>. The problem is this interface contains a method <code>Iterator</code> that returns a different type in the generic version to the non-generic version. The generated code implements this method returning a <code>StdMapWStringWStringMapIterator</code>, but the non-generic version expects a method returning <code>IIterator</code>, so you get a compiler error.</p><p>This is simple enough to fix - you just need to change the return type of the binding to be <code>IIterator</code>, and this can be done in the <code>Metadata.xml</code> file.</p><p>The <code>Metadata.xml</code> file is a file containing transforms that you want to make to the generated code - and can be adding new items, removing items or change the attributes of items such as the name or the return type.</p><p>Open the generated code from the <code>obj/${Congfiguration}/generated/src/</code> folder - the file will be called <code>Microsoft.Azure.CognitiveServices.Speech.Internal.StdMapWStringWString.cs</code>. If you look at all the public items in this file (the class, public methods and public properties), you will see each one has a comment describing the <code>Metadata.xml path</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#75715e>// Metadata.xml XPath class reference: path=&#34;/api/package[@name=&#39;com.microsoft.cognitiveservices.speech.internal&#39;]/class[@name=&#39;StdMapWStringWStringMapIterator&#39;]&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>partial</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StdMapWStringWStringMapIterator</span>
</span></span><span style=display:flex><span>    ...
</span></span></code></pre></div><p>This path is used to identify each item to the <code>Metadata.xml</code> file, so locate the <code>Iterator()</code> method and note the <code>path</code>.</p><p>Open the <code>Metadata.xml</code> file and add a new <code>attr</code> node inside the <code>metadata</code> node. Set the <code>path</code> attribute of this node to match the path in the comment for the <code>Iterator()</code> method. Then add an attribute called <code>name</code> with the value <code>managedReturn</code> to tell the transformations that this is a changed to the managed return type - so the type for the binding library only. This will treat the underlying return value as the original type which is what you want. The value for this attribute is set inside the node, and should be <code>Java.Util.IIterator</code>.</p><p>The full node is shown below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;metadata&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;attr</span> <span style=color:#a6e22e>path=</span><span style=color:#e6db74>&#34;/api/package[@name=&#39;com.microsoft.cognitiveservices.speech.internal&#39;]/class[@name=&#39;StdMapWStringWString&#39;]/method[@name=&#39;iterator&#39; and count(parameter)=0]&#34;</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;managedReturn&#34;</span><span style=color:#f92672>&gt;</span>Java.Util.IIterator<span style=color:#f92672>&lt;/attr&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/metadata&gt;</span>
</span></span></code></pre></div><p>Now if you compile the project, one error will be gone. If you re-open the generated file you will see the new return type.</p><p>You can read more on the capabilities if this file in the <a href="https://docs.microsoft.com/xamarin/android/platform/binding-java-library/customizing-bindings/java-bindings-metadata/?WT.mc_id=speech-blog-jabenn">docs</a>.</p><h3 id=fixing-the-stdmapwstringwstringmapiterator-code>Fixing the <code>StdMapWStringWStringMapIterator</code> code</h3><p>The Xamarin Java SDK doesn&rsquo;t contain the generic version of <code>IIterator</code>, so the bound code uses the non-generic version. This interface has a <code>Next()</code> method that returns the next item from the collection being iterated. In the non-generic version of this interface, <code>Next()</code> returns a <code>Java.Lang.Object</code>, whereas in the generic version it returns the generic arg, in this case a <code>Java.Lang.String</code>. This means the generated code uses the non-generic interface, but the implementation uses the generic method, causing a compiler error.</p><p>The fix for this is a little bit more work - you can&rsquo;t just change the return type as it is used in a private method created by the binding. Instead, the fix for this is to remove the generic <code>Next()</code> method and replace it with a non-generic version. Re-writing binding methods is not easy as there is a lot of code in the binding, so for cases like this the best way is to copy the generated code, adjusting it to suit. If you open the <code>com.microsoft.cognitiveservices.speech.internal.StdMapWStringWStringMapIterator.cs</code> file from the <code>obj</code> directory, and look at the <code>Next()</code> method you will see the implementation consists of not just the <code>Next()</code> method, but also an <code>n_next()</code> method, a <code>GetNextHandler()</code> method and a <code>cb_next</code> <code>Delegate</code> field. This is all the plumbing needed to create the binding method and call through to the underlying Java method.</p><h4 id=adding-the-new-method>Adding the new method</h4><p>Lets&rsquo;s start by adding the new method as this will mostly be a copy of the existing code. Add a new class to the <code>Additions</code> folder called <code>StdMapWStringWStringMapIterator</code>, mark the class as <code>partial</code> and change the namespace to match the generated file (these will be fixed up later to be more C#-like).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>namespace</span> Com.Microsoft.Cognitiveservices.Speech.Internal 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>partial</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StdMapWStringWStringMapIterator</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Copy the <code>Next()</code>, <code>GetNextHandler()</code>, <code>n_next()</code> methods and the <code>cb_next</code> field from the generated code and paste them into the new class part. Strip out any unnecessary namespaces and use <code>var</code> everywhere - this will make it easier when you change the namespaces to be more C#-like in the next post.</p><p>Change the return type of <code>Next</code> to be <code>Java.Lang.Object</code> instead of <code>Java.Lang.String</code>. Leave the types in the <code>Register</code> attribute and <code>__id</code> fields as they are, as the underlying method that is called returns a <code>Java.Lang.String</code>, and you only need to change the return type for the binding wrapper.</p><p>In the <code>n_next()</code> method, change the <code>return</code> call to call <code>ToString()</code> on the result of the call to <code>Next()</code> to use the correct type. The final code will look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>namespace</span> Com.Microsoft.Cognitiveservices.Speech.Internal
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>partial</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StdMapWStringWStringMapIterator</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>static</span> Delegate cb_next;
</span></span><span style=display:flex><span><span style=color:#75715e># pragma</span> warning disable <span style=color:#ae81ff>0169</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>static</span> Delegate GetNextHandler()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (cb_next == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>                cb_next = JNINativeWrapper.CreateDelegate((Func&lt;IntPtr, IntPtr, IntPtr&gt;)n_Next);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cb_next;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>static</span> IntPtr n_Next(IntPtr jnienv, IntPtr native__this)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> __this = Object.GetObject&lt;StdMapWStringWStringMapIterator&gt;(jnienv, native__this, JniHandleOwnership.DoNotTransfer);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> JNIEnv.NewString(__this.Next()?.ToString()); <span style=color:#75715e>// ToString called on the object.</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span><span style=color:#75715e># pragma</span> warning restore <span style=color:#ae81ff>0169</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>        [Register(&#34;next&#34;, &#34;()Ljava/lang/String;&#34;, &#34;GetNextHandler&#34;)]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>unsafe</span> Java.Lang.Object Next() <span style=color:#75715e>// Return type changed from string to object</span>
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>string</span> __id = <span style=color:#e6db74>&#34;next.()Ljava/lang/String;&#34;</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> __rm = _members.InstanceMethods.InvokeVirtualObjectMethod(__id, <span style=color:#66d9ef>this</span>, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> JNIEnv.GetString(__rm.Handle, JniHandleOwnership.TransferLocalRef);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>finally</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=removing-the-next-method>Removing the <code>Next</code> method</h4><p>To remove a method from the autogenerated file, you add a <code>remove-node</code> entry to the <code>Metadata.xml</code> file with the path of the <code>Next()</code> method node you want to remove. To remove the <code>Next()</code> method, add this following to this file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;remove-node</span> <span style=color:#a6e22e>path=</span><span style=color:#e6db74>&#34;/api/package[@name=&#39;com.microsoft.cognitiveservices.speech.internal&#39;]/class[@name=&#39;StdMapWStringWStringMapIterator&#39;]/method[@name=&#39;next&#39; and count(parameter)=0]&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span></code></pre></div><p>The syntax is <code>&lt;remove-node path="..."/></code> where the <code>path</code> comes from the comment in the generated code. Once this line has been added, compile the code and check the generated file in the <code>obj</code> directory. The compiler error about the missing <code>Next()</code> method will have gone, and the <code>Next()</code> method will be removed from the autogenerated file - when the library is built it will use the version in the file in the <code>Additions</code> folder.</p><p>You should now be able to compile this library successfully.</p><hr><p>In the <a href=/blogs/binding-the-cognitive-services-android-speech-sdk-part-2-making-the-code-more-c-like/>second part</a>, I&rsquo;ll show how you can make the code more C#-like. You can find the code for this <a href=https://github.com/jimbobbennett/SpeechSdkXamarinSample>in my GitHub</a>, and you can read more on <a href="https://docs.microsoft.com/xamarin/android/platform/binding-java-library/?WT.mc_id=speech-blog-jabenn">docs.microsoft.com</a></p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#binding-the-sdk>Binding the SDK</a></li><li><a href=#making-it-work>Making it work</a><ul><li><a href=#metadataxml-and-additions>Metadata.xml and Additions</a></li><li><a href=#fixing-the-stdmapwstringwstring-code>Fixing the <code>StdMapWStringWString</code> code</a></li><li><a href=#fixing-the-stdmapwstringwstringmapiterator-code>Fixing the <code>StdMapWStringWStringMapIterator</code> code</a></li></ul></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/technology target=_blank>Technology</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/xamarin target=_blank>xamarin</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/xamarin.android target=_blank>xamarin.android</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/java target=_blank>java</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/binding target=_blank>binding</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/aar target=_blank>aar</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/jar target=_blank>jar</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://jimbobbennett.dev/blogs/binding-the-cognitive-services-android-speech-sdk/",this.page.identifier="e7f5e1415dec53fe67c8ca8c97f71fea"};(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://jimbobbennett.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2025 All Rights Reserved</div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js integrity=sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13 crossorigin=anonymous></script><script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script>function createCopyButton(e,t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy",n.addEventListener("click",()=>copyCodeToClipboard(n,e,t)),addCopyButtonToDom(n,e)}async function copyCodeToClipboard(e,t,n){const s=t.querySelector("pre > code").innerText;try{n.writeText(s)}finally{codeWasCopied(e)}}function codeWasCopied(e){e.blur(),e.innerText="Copied!",setTimeout(function(){e.innerText="Copy"},2e3)}function addCopyButtonToDom(e,t){t.insertBefore(e,t.firstChild);const n=document.createElement("div");n.className="highlight-wrapper",t.parentNode.insertBefore(n,t),n.appendChild(t)}if(navigator&&navigator.clipboard)document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,navigator.clipboard));else{var script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",script.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",script.crossOrigin="anonymous",script.onload=function(){addCopyButtons(clipboard)},document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,script)),document.body.appendChild(script)}</script></body></html>