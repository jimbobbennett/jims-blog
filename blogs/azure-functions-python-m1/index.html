<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon href=/fav.png type=image/png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="Run Azure Functions with Python on Apple Silicon"><meta property="og:description" content="If you are an Apple user and you want to build Azure Functions using Python, then you&rsquo;ve been out of luck. The Azure Functions core tools don&rsquo;t support Python functions on Arm64. There is a workaround, and this post shows you how.
Arm64 support in Azure Functions Apple moved to an Arm64 architecture with their Apple Silicon processors (currently M1 and M2) back in November 2020, with their entire linup now using Apple Silicon, except for the rather outdated Mac Pro."><meta property="og:type" content="article"><meta property="og:url" content="https://jimbobbennett.dev/blogs/azure-functions-python-m1/"><meta property="og:image" content="https://jimbobbennett.dev/blogs/azure-functions-python-m1/banner.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2023-05-08T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-08T00:00:00+00:00"><meta property="og:site_name" content="JimBobBennett"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jimbobbennett.dev/blogs/azure-functions-python-m1/banner.png"><meta name=twitter:title content="Run Azure Functions with Python on Apple Silicon"><meta name=twitter:description content="If you are an Apple user and you want to build Azure Functions using Python, then you&rsquo;ve been out of luck. The Azure Functions core tools don&rsquo;t support Python functions on Arm64. There is a workaround, and this post shows you how.
Arm64 support in Azure Functions Apple moved to an Arm64 architecture with their Apple Silicon processors (currently M1 and M2) back in November 2020, with their entire linup now using Apple Silicon, except for the rather outdated Mac Pro."><meta name=twitter:site content="@jimbobbennett"><meta name=twitter:creator content="@jimbobbennett"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><link rel="shortcut icon" type=image/png href=/fav.png><link rel="shortcut icon" sizes=192x192 href=/fav.png><link rel=apple-touch-icon href=/fav.png><link rel=alternate type=application/rss+xml href=https://jimbobbennett.dev/index.xml title=JimBobBennett><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","dctc2ydykv")</script><script data-goatcounter=https://jimbobbennett.goatcounter.com/count async src=//gc.zgo.at/count.js></script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#000;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#000000;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{background-color:#000;font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=/css/single.css><link rel=stylesheet href=/css/projects.css media=all><script defer src=/fontawesome-5/all-5.15.4.js></script><title>Run Azure Functions with Python on Apple Silicon | JimBobBennett</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
JimBobBennett
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/ aria-label=home>Home</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Recent Highlights</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/videos title=Videos>Videos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/livestreams title=Livestreams>Livestreams</a></li><li class="nav-item navbar-text"><a class=nav-link href=/conferences title=Conferences>Conferences</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul></div></div></nav></header><div id=content><section id=projects><div class="container pt-5" id=list-page><div class="row justify-content-center px-3 px-md-5"><h1 class="text-left pb-2 content">Run Azure Functions with Python on Apple Silicon</h1><div class="text-left content"><a href=https://linkedin.com/in/jimbobbennett>Jim Bennett
</a><small>|</small>
May 8, 2023</div></div></div></section><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><article class="page-content p-2"><p>If you are an Apple user and you want to build Azure Functions using Python, then you&rsquo;ve been out of luck. The Azure Functions core tools don&rsquo;t support Python functions on Arm64. There is a workaround, and this post shows you how.</p><h2 id=arm64-support-in-azure-functions>Arm64 support in Azure Functions</h2><p>Apple moved to an Arm64 architecture with their Apple Silicon processors (currently M1 and M2) back in November 2020, with their entire linup now using Apple Silicon, except for the rather outdated Mac Pro. Despite this, support for running Python functions on Arm64 has not yet materialized. You can create functions with <code>func init</code> and <code>func new</code>, but when you run them, you get an error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>➜  functions-m1 func start
</span></span><span style=display:flex><span>Found Python version 3.10.11 <span style=color:#f92672>(</span>python3<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Azure Functions Core Tools
</span></span><span style=display:flex><span>Core Tools Version:       4.0.5095 Commit hash: N/A  <span style=color:#f92672>(</span>64-bit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Function Runtime Version: 4.16.5.20396
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T21:29:33.030Z<span style=color:#f92672>]</span> Failed to initialize worker provider <span style=color:#66d9ef>for</span>: /opt/homebrew/Cellar/azure-functions-core-tools@4/4.0.5095/workers/python
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T21:29:33.030Z<span style=color:#f92672>]</span> Microsoft.Azure.WebJobs.Script: Architecture Arm64 is not supported <span style=color:#66d9ef>for</span> language python.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T21:29:33.409Z<span style=color:#f92672>]</span> Failed to initialize worker provider <span style=color:#66d9ef>for</span>: /opt/homebrew/Cellar/azure-functions-core-tools@4/4.0.5095/workers/python
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T21:29:33.409Z<span style=color:#f92672>]</span> Microsoft.Azure.WebJobs.Script: Architecture Arm64 is not supported <span style=color:#66d9ef>for</span> language python.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T21:29:33.558Z<span style=color:#f92672>]</span> A host error has occurred during startup operation <span style=color:#e6db74>&#39;2a13f8c8-f2e4-4da0-a88c-205dbd3065c2&#39;</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T21:29:33.558Z<span style=color:#f92672>]</span> Microsoft.Azure.WebJobs.Script: Did not find functions with language <span style=color:#f92672>[</span>python<span style=color:#f92672>]</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T21:29:33.564Z<span style=color:#f92672>]</span> Failed to stop host instance <span style=color:#e6db74>&#39;1e7799d1-a87f-404a-9bc1-858c7724aeec&#39;</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T21:29:33.564Z<span style=color:#f92672>]</span> Microsoft.Azure.WebJobs.Host: The host has not yet started.
</span></span><span style=display:flex><span>Value cannot be null. <span style=color:#f92672>(</span>Parameter <span style=color:#e6db74>&#39;provider&#39;</span><span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Microsoft originally targeted support for their Python 3.10 release, but missed this. Currently they are saying it will come with Python 3.11 support, as documented in <a href=https://github.com/Azure/azure-functions-python-worker/issues/915>this GitHub issue</a>. Their suggested workaround involves changing your Terminal to always run under Rosetta 2 which feels like a bad way to do things. There is a better workaround, leveraging dev containers.</p><h2 id=dev-containers>Dev containers</h2><p>Dev containers are docker containers that you run and connect to from VS Code. As a user these are seamless - you can still access the file system from outside of VS Code, but internally the dev environment runs in the container, with all your dependencies installed in the container instead of on your host OS. You can read about these on <a href=https://code.visualstudio.com/docs/devcontainers/containers>the VS Code developing inside containers documentation</a>.</p><p>Docker supports running x86 and x64 containers on Apple Silicon Macs using either QEMU emulation, or using Rosetta 2. This means you can create an x64 container and run this on your Mac, running the Azure Functions core tools inside the container! Pretty cool, hey!</p><h2 id=configure-docker>Configure docker</h2><p>You need <a href=https://www.docker.com>docker</a> installed, so get this installed first. Once installed, you need to configure a few things.</p><ul><li><p>From the docker menu item, select <strong>Settings</strong></p></li><li><p>From the <strong>General</strong> section, ensure <em>Use Virtualization framework</em> is selected</p><p><img src=docker-general-virtualization.png alt="The Use Virtualization framework in the general tab of the settings dialog"></p></li><li><p>From the <strong>Features in development</strong> section, select the <strong>Beat Features</strong> and select <em>Use Rosetta for x86/amd64 emulation on Apple Silicon</em></p><p><img src=docker-rosetta.png alt="The Use Rosetta for x86/amd64 emulation on Apple Silicon setting from the Features in development section"></p></li><li><p>Apply these changes and docker desktop will restart.</p></li></ul><h2 id=create-the-dev-container>Create the dev container</h2><p>The default Azure Functions and Python3 dev container is ideal for this as it is an x86/x64 container.</p><ul><li><p>Make sure docker is running.</p></li><li><p>Create a folder for your Azure Functions app and open it in VS Code (or open the one you already have created)</p></li><li><p>Ensure you have the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">Dev Containers extension</a> installed. This also comes with the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack">Remote Development extension Pack</a>.</p></li><li><p>Open the command palette and select <em>Dev Containers: Add Dev Container configuration files&mldr;</em></p><p><img src=dev-containers-add-files.png alt="The Dev Containers: Add Dev Container configuration files command palette option"></p></li><li><p>Select <em>Show all definitions</em> to see all the dev container options</p><p><img src=dev-containers-show-all.png alt="The show all definitions option"></p></li><li><p>Search for and select <em>Azure Functions & Python 3</em></p><p><img src=dev-containers-func-python.png alt="The definitions filtered by Azure Functions with the cursor over Azure Functions & Python 3"></p></li><li><p>Select any other features you want. You don&rsquo;t need any for Azure Functions to work.</p></li><li><p>The container files will be built, and an option will pop up to re-open the folder in the container. Select <strong>Reopen in Container</strong></p><p><img src=reopen-in-container.png alt="The reopen in container popup"></p></li><li><p>Once the repo has been re-opened in the container, open the terminal and you will see it marked as running under Rosetta</p><p><img src=rosetta-terminal.png alt="The terminal with an indicator on the toolbar showing it is running under Rosetta"></p></li><li><p>If you don&rsquo;t already have an Azure Functions app, you can now create one.</p></li><li><p>Run your Azure Functions app!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vscode ➜ /workspaces/functions-arm $ func start
</span></span><span style=display:flex><span>Found Python version 3.9.16 <span style=color:#f92672>(</span>python3<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Azure Functions Core Tools
</span></span><span style=display:flex><span>Core Tools Version:       4.0.5148 Commit hash: N/A  <span style=color:#f92672>(</span>64-bit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Function Runtime Version: 4.17.3.20392
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Functions:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        HttpTrigger: <span style=color:#f92672>[</span>GET,POST<span style=color:#f92672>]</span> http://localhost:7071/api/HttpTrigger
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For detailed output, run func with --verbose flag.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T22:07:35.900Z<span style=color:#f92672>]</span> Worker process started and initialized.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2023-05-08T22:07:38.282Z<span style=color:#f92672>]</span> Host lock lease acquired by instance ID <span style=color:#e6db74>&#39;0000000000000000000000008A10FEBD&#39;</span>.
</span></span></code></pre></div></li></ul><p>Once you commit the devcontainer files to GitHub, you will also be able to open this in a Codespace and have it pre-configured with everything you need. You can also add more things to the container depending on your needs, such as extensions that are automatically loaded when the container is loaded, install things, whatever you need! Check out the <a href=https://code.visualstudio.com/docs/devcontainers/containers>the VS Code developing inside containers documentation</a> to learn more.</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#arm64-support-in-azure-functions>Arm64 support in Azure Functions</a></li><li><a href=#dev-containers>Dev containers</a></li><li><a href=#configure-docker>Configure docker</a></li><li><a href=#create-the-dev-container>Create the dev container</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/apple target=_blank>apple</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/azure target=_blank>azure</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/azurefunctions target=_blank>azurefunctions</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/functions target=_blank>functions</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/m1 target=_blank>m1</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/m2 target=_blank>m2</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/applesilicon target=_blank>applesilicon</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://jimbobbennett.dev/blogs/azure-functions-python-m1/",this.page.identifier="f936b17dd982837e58b4390d02be2b10"};(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://jimbobbennett.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2024 All Rights Reserved</div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js integrity=sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13 crossorigin=anonymous></script><script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script>function createCopyButton(e,t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy",n.addEventListener("click",()=>copyCodeToClipboard(n,e,t)),addCopyButtonToDom(n,e)}async function copyCodeToClipboard(e,t,n){const s=t.querySelector("pre > code").innerText;try{n.writeText(s)}finally{codeWasCopied(e)}}function codeWasCopied(e){e.blur(),e.innerText="Copied!",setTimeout(function(){e.innerText="Copy"},2e3)}function addCopyButtonToDom(e,t){t.insertBefore(e,t.firstChild);const n=document.createElement("div");n.className="highlight-wrapper",t.parentNode.insertBefore(n,t),n.appendChild(t)}if(navigator&&navigator.clipboard)document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,navigator.clipboard));else{var script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",script.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",script.crossOrigin="anonymous",script.onload=function(){addCopyButtons(clipboard)},document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,script)),document.body.appendChild(script)}</script></body></html>