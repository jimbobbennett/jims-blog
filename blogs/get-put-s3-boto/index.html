<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon href=/fav.png type=image/png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="How to generate pre-signed URLs to get and put objects in S3 with Boto3 in Python"><meta property="og:description" content="How to generate pre-signed URLs to get and put objects into S3 buckets in Python using boto3, and avoid access denied errors with the URLs created using the `put_object` client method."><meta property="og:type" content="article"><meta property="og:url" content="https://jimbobbennett.dev/blogs/get-put-s3-boto/"><meta property="og:image" content="https://jimbobbennett.dev/blogs/get-put-s3-boto/banner.webp"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2024-02-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-01T00:00:00+00:00"><meta property="og:site_name" content="JimBobBennett"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jimbobbennett.dev/blogs/get-put-s3-boto/banner.webp"><meta name=twitter:title content="How to generate pre-signed URLs to get and put objects in S3 with Boto3 in Python"><meta name=twitter:description content="How to generate pre-signed URLs to get and put objects into S3 buckets in Python using boto3, and avoid access denied errors with the URLs created using the `put_object` client method."><meta name=twitter:site content="@jimbobbennett"><meta name=twitter:creator content="@jimbobbennett"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><link rel="shortcut icon" type=image/png href=/fav.png><link rel="shortcut icon" sizes=192x192 href=/fav.png><link rel=apple-touch-icon href=/fav.png><link rel=alternate type=application/rss+xml href=https://jimbobbennett.dev//index.xml title=JimBobBennett><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","dctc2ydykv")</script><script data-goatcounter=https://jimbobbennett.goatcounter.com/count async src=//gc.zgo.at/count.js></script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#000;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#000000;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{background-color:#000;font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content="How to generate pre-signed URLs to get and put objects into S3 buckets in Python using boto3, and avoid access denied errors with the URLs created using the `put_object` client method."><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=/css/single.css><link rel=stylesheet href=/css/projects.css media=all><script defer src=/fontawesome-5/all-5.15.4.js></script><title>How to generate pre-signed URLs to get and put objects in S3 with Boto3 in Python | JimBobBennett</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
JimBobBennett
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/ aria-label=home>Home</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Recent Highlights</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/videos title=Videos>Videos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/podcasts title=Podcasts>Podcasts</a></li><li class="nav-item navbar-text"><a class=nav-link href=/livestreams title=Livestreams>Livestreams</a></li><li class="nav-item navbar-text"><a class=nav-link href=/conferences title=Conferences>Conferences</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul></div></div></nav></header><div id=content><section id=projects><div class="container pt-5" id=list-page><div class="row justify-content-center px-3 px-md-5"><h1 class="text-left pb-2 content">How to generate pre-signed URLs to get and put objects in S3 with Boto3 in Python</h1><div class="text-left content"><a href=https://linkedin.com/in/jimbobbennett>Jim Bennett
</a><small>|</small>
Feb 1, 2024</div></div></div></section><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><article class="page-content p-2"><p><img src=banner.webp alt="A plushie llama putting blocks into a bucket"></p><blockquote><p>TL;DR: If your <code>put_object</code> boto3 pre-signed URLs are failing with access denied errors, add <code>config=Config(signature_version="s3v4")</code> when creating the boto3 client to get a working URL.</p></blockquote><p>I was recently working on some Python code to interact with S3 buckets, where I needed to be able to generate some pre-signed URLs for S3 objects. These are URLs that contain a built-in time-limited credential to allow access, meaning that you can give this URL to anyone and they can read an object, or write it without access to your AWS account or S3 bucket - they only have access to that one object.</p><p>In Python there is a helpful library called <a href=https://boto3.amazonaws.com/v1/documentation/api/latest/index.html#>boto3 from Amazon</a> that can be used to interact with AWS services. This includes S3, and it has a method to generate pre-signed URLs for objects.</p><h2 id=get-started-with-boto3>Get started with boto3</h2><h3 id=set-your-credentials>Set your credentials</h3><p>You can only access S3 if you have the correct credentials. These are your AWS access key and secret key, and need to be set in your AWS credentials file using the AWS CLI:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws configure
</span></span></code></pre></div><p>Or you can edit the <code>~/.aws/credentials</code> file directly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[default]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>aws_access_key_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>YOUR_ACCESS_KEY</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>aws_secret_access_key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>YOUR_SECRET</span>
</span></span></code></pre></div><h3 id=install-boto3>Install boto3</h3><p>To use boto3, you need to install it in your current Python environment. This can be done with pip:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install boto3
</span></span></code></pre></div><p>Obviously using a virtual environment or a development container is a good idea, but I&rsquo;ll leave that up to you üòÅ.</p><p>Once done, you just need to import boto3 into your Python code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> boto3
</span></span></code></pre></div><p>Then you need to create a client for the service you want to use. In this case, S3:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>region <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;us-east-1&#39;</span>
</span></span><span style=display:flex><span>s3 <span style=color:#f92672>=</span> boto3<span style=color:#f92672>.</span>client(<span style=color:#e6db74>&#39;s3&#39;</span>,
</span></span><span style=display:flex><span>                  region_name<span style=color:#f92672>=</span>region)
</span></span></code></pre></div><p>Clients are regional, so you need to specify the region you want to use. In this case, I&rsquo;m using <code>us-east-1</code>.</p><h2 id=create-pre-signed-urls>Create pre-signed URLs</h2><p>Once the client is created, you can use it to generate pre-signed URLs for objects in your S3 bucket using the <code>generate_presigned_url</code> method.</p><h3 id=create-a-get-object-pre-signed-url>Create a get object pre-signed URL</h3><p>The first case I needed was for someone to be able to download an object from my S3 bucket. In AWS, this is the <code>get_object</code> client method.</p><p>Here is the code to generate a pre-signed URL for getting an object in an S3 bucket:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>url <span style=color:#f92672>=</span> s3<span style=color:#f92672>.</span>generate_presigned_url(
</span></span><span style=display:flex><span>    ClientMethod<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;get_object&#39;</span>,
</span></span><span style=display:flex><span>    Params<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Bucket&#39;</span>: <span style=color:#e6db74>&#39;my-bucket&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Key&#39;</span>: <span style=color:#e6db74>&#39;my-object&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    ExpiresIn<span style=color:#f92672>=</span><span style=color:#ae81ff>3600</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>This takes the client method - <code>get_object</code>, the parameters - the bucket and the object key, and the time the URL is valid for in seconds.</p><p>This gives you a working URL that anyone can use for the object <code>my-object</code> in the bucket <code>my-bucket</code> that is valid for 3600 seconds, or 1 hour. You share that URL with someone, and they can download that one object only.</p><h3 id=create-a-put-object-pre-signed-url>Create a put object pre-signed URL</h3><p>The second case I needed was for someone to be able to upload an object to my S3 bucket. In AWS, this is the <code>put_object</code> client method.</p><p>Now, in theory this is the same as the <code>get_object</code> call just with a different client method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>url <span style=color:#f92672>=</span> s3<span style=color:#f92672>.</span>generate_presigned_url(
</span></span><span style=display:flex><span>    ClientMethod<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;put_object&#39;</span>,
</span></span><span style=display:flex><span>    Params<span style=color:#f92672>=</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Bucket&#39;</span>: <span style=color:#e6db74>&#39;my-bucket&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;Key&#39;</span>: <span style=color:#e6db74>&#39;new-object&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    ExpiresIn<span style=color:#f92672>=</span><span style=color:#ae81ff>3600</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>As we all know, theory and practice are the same in theory, but not in practice. This code will generate a URL, but when you try to use it, you will get an XML document with an access denied error.</p><pre tabindex=0><code class=language-output data-lang=output>The request signature we calculated does not match the signature
</code></pre><p>This took hours to get to the bottom of, but after plenty of S3 reconfiguration and some googling, I found the solution in <a href=https://stackoverflow.com/a/63791634/1034742>an answer buried in this stack overflow question</a></p><p><img src=so-answer.webp alt="A stack overflow answer saying For Python set - signature_version s3v4"></p><p>It seems this configuration option is not well documented. It is mentioned in the <a href=https://botocore.amazonaws.com/v1/documentation/api/latest/reference/config.html>boto config docs</a> but without any details on why you need a different signature version for <code>put_object</code> URLs, or what the default is.</p><p>So, to generate a working pre-signed URL for <code>put_object</code> in S3, you need to add the <code>signature_version</code> to the <code>Config</code> object when creating the client:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> botocore.config <span style=color:#f92672>import</span> Config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>s3 <span style=color:#f92672>=</span> boto3<span style=color:#f92672>.</span>client(<span style=color:#e6db74>&#39;s3&#39;</span>,
</span></span><span style=display:flex><span>                  region_name<span style=color:#f92672>=</span>region,
</span></span><span style=display:flex><span>                  config<span style=color:#f92672>=</span>Config(signature_version<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;s3v4&#34;</span>))
</span></span></code></pre></div><p>Once you have done this, the code above to generate a pre-signed URL for <code>put_object</code> will create a URL that works as expected. You can now share this with anyone and they will be able to upload a new object to your S3 bucket, with the key given in the params.</p><p>In the example above, they would be able to upload an object to the bucket <code>my-bucket</code> with the key <code>new-object</code>. Again, the URL has an expiry, so is valid for 3600 seconds, or 1 hour.</p><h2 id=conclusion>Conclusion</h2><p><a href=https://stackoverflow.com/users/6514028/saurav-sarkar>Saurav Sakar</a>, you are my hero! If you are creating re-signed URLs, make sure to set the <code>signature_version</code> to <code>s3v4</code> in the <code>Config</code> object when creating the client.</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#get-started-with-boto3>Get started with boto3</a><ul><li><a href=#set-your-credentials>Set your credentials</a></li><li><a href=#install-boto3>Install boto3</a></li></ul></li><li><a href=#create-pre-signed-urls>Create pre-signed URLs</a><ul><li><a href=#create-a-get-object-pre-signed-url>Create a get object pre-signed URL</a></li><li><a href=#create-a-put-object-pre-signed-url>Create a put object pre-signed URL</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/aws target=_blank>aws</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/s3 target=_blank>s3</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/boto target=_blank>boto</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://jimbobbennett.dev/blogs/get-put-s3-boto/",this.page.identifier="a2c2a2517218a038777fe256c3922208"};(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://jimbobbennett.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2024 All Rights Reserved</div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js integrity=sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13 crossorigin=anonymous></script><script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script>function createCopyButton(e,t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy",n.addEventListener("click",()=>copyCodeToClipboard(n,e,t)),addCopyButtonToDom(n,e)}async function copyCodeToClipboard(e,t,n){const s=t.querySelector("pre > code").innerText;try{n.writeText(s)}finally{codeWasCopied(e)}}function codeWasCopied(e){e.blur(),e.innerText="Copied!",setTimeout(function(){e.innerText="Copy"},2e3)}function addCopyButtonToDom(e,t){t.insertBefore(e,t.firstChild);const n=document.createElement("div");n.className="highlight-wrapper",t.parentNode.insertBefore(n,t),n.appendChild(t)}if(navigator&&navigator.clipboard)document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,navigator.clipboard));else{var script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",script.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",script.crossOrigin="anonymous",script.onload=function(){addCopyButtons(clipboard)},document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,script)),document.body.appendChild(script)}</script></body></html>