<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon href=/fav.png type=image/png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="Fabulous Santa Tracker"><meta property="og:description" content="&lsquo;Twas the night before Christmas, and all through the house&mldr;
For millions of people worldwide, Christmas eve is a time of magic. Children are excited and unable to sleep because&mldr;
Santa is coming tonight!!!!
This is the one night of the year you want a stranger to come into your house whilst you sleep. He&rsquo;ll magic his way in (cos who has a chimney these days, right?), and leave presents under your tree."><meta property="og:type" content="article"><meta property="og:url" content="https://jimbobbennett.dev/blogs/fabulous-santa-tracker/"><meta property="og:image" content="https://jimbobbennett.dev/blogs/fabulous-santa-tracker/banner.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2018-12-24T00:00:00+00:00"><meta property="article:modified_time" content="2018-12-24T00:00:00+00:00"><meta property="og:site_name" content="JimBobBennett"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jimbobbennett.dev/blogs/fabulous-santa-tracker/banner.png"><meta name=twitter:title content="Fabulous Santa Tracker"><meta name=twitter:description content="&lsquo;Twas the night before Christmas, and all through the house&mldr;
For millions of people worldwide, Christmas eve is a time of magic. Children are excited and unable to sleep because&mldr;
Santa is coming tonight!!!!
This is the one night of the year you want a stranger to come into your house whilst you sleep. He&rsquo;ll magic his way in (cos who has a chimney these days, right?), and leave presents under your tree."><meta name=twitter:site content="@jimbobbennett"><meta name=twitter:creator content="@jimbobbennett"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><link rel="shortcut icon" type=image/png href=/fav.png><link rel="shortcut icon" sizes=192x192 href=/fav.png><link rel=apple-touch-icon href=/fav.png><link rel=alternate type=application/rss+xml href=https://jimbobbennett.dev//index.xml title=JimBobBennett><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","dctc2ydykv")</script><script data-goatcounter=https://jimbobbennett.goatcounter.com/count async src=//gc.zgo.at/count.js></script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#000;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#000000;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{background-color:#000;font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=/css/single.css><link rel=stylesheet href=/css/projects.css media=all><script defer src=/fontawesome-5/all-5.15.4.js></script><title>Fabulous Santa Tracker | JimBobBennett</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
JimBobBennett
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/ aria-label=home>Home</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Recent Highlights</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/videos title=Videos>Videos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/podcasts title=Podcasts>Podcasts</a></li><li class="nav-item navbar-text"><a class=nav-link href=/livestreams title=Livestreams>Livestreams</a></li><li class="nav-item navbar-text"><a class=nav-link href=/conferences title=Conferences>Conferences</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul></div></div></nav></header><div id=content><section id=projects><div class="container pt-5" id=list-page><div class="row justify-content-center px-3 px-md-5"><h1 class="text-left pb-2 content">Fabulous Santa Tracker</h1><div class="text-left content"><a href=https://linkedin.com/in/jimbobbennett>Jim Bennett
</a><small>|</small>
Dec 24, 2018</div></div></div></section><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><article class="page-content p-2"><blockquote><p><em>&lsquo;Twas the night before Christmas,
and all through the house&mldr;</em></p></blockquote><p>For millions of people worldwide, Christmas eve is a time of magic. Children are excited and unable to sleep because&mldr;</p><p>Santa is coming tonight!!!!</p><div class=image-div style=max-width:600px><p><img src=srikanta-h-u-51975-unsplash-1.jpg alt=Santa></p></div><p>This is the one night of the year you want a stranger to come into your house whilst you sleep. He&rsquo;ll magic his way in (cos who has a chimney these days, right?), and leave presents under your tree.</p><blockquote><p><em>He know if you are sleeping,
He knows if you&rsquo;re awake&mldr;</em></p></blockquote><p>But - and this is important, he only comes if you are asleep. So children, you need to be asleep early. But how early? How do you know when you need to be asleep by?</p><p>For this - you need a Santa tracker mobile app. And not just any Santa tracker, a Fabulous one!</p><div class=image-div style=max-width:400px><p><img src=Simulator-Screen-Shot---iPhone-8---2018-12-05-at-11.31.25-1.png alt="Screenshot of Santa tracker app"></p></div><p>This app is pretty simple. It knows where Santa is at any given time on Christmas eve, and based on the current time displays the location of Santa on a map, along with a running count of how many presents he&rsquo;s delivered so far to all the good girls and boys.</p><p>The code is all on <a href=https://github.com/jimbobbennett/FabulousSantaTracker>GitHub</a> if you want to check it out.</p><h3 id=building-the-santa-tracker>Building the Santa tracker</h3><p>To build this app I needed a source of data, and a mobile app.</p><h5 id=where-did-the-data-come-from>Where did the data come from?</h5><p>Every year for the past decade or so, NORAD has been <a href=https://www.noradsanta.org>tracking Santa online</a> every Christmas eve. Unfortunately they don&rsquo;t seem to have a public API that I could find to use. Luckily Google has <a href=https://santatracker.google.com/village.html>got in on the action</a>, and provides <a href=https://storage.googleapis.com/santa/route-v1/santa_en.json>an undocumented API</a> to download a JSON file containing Santas coordinates from last year. I simply downloaded that JSON document to use. The structure is pretty simple, and I&rsquo;ve shown a snippet of it below showing only the bits I&rsquo;m interested in.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;destinations&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;arrival&#34;</span>: <span style=color:#ae81ff>31536000000</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;presentsDelivered&#34;</span>: <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;city&#34;</span>: <span style=color:#e6db74>&#34;Santa&#39;s Village&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;region&#34;</span>: <span style=color:#e6db74>&#34;North Pole&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;location&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>84.6</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>168</span>
</span></span><span style=display:flex><span>       }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;arrival&#34;</span>: <span style=color:#ae81ff>1514110140000</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;presentsDelivered&#34;</span>: <span style=color:#ae81ff>46415</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;city&#34;</span>: <span style=color:#e6db74>&#34;Provideniya&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;region&#34;</span>: <span style=color:#e6db74>&#34;Russia&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;location&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;lat&#34;</span>: <span style=color:#ae81ff>64.436249</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;lng&#34;</span>: <span style=color:#ae81ff>-173.233337</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>...</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>]</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This gives a city and region name for each stop, total presents delivered, the latitude and longitude of the location and the arrival time. This arrival time is the number of milliseconds since the UNIX epoch - 1 Jan 1970.</p><h5 id=creating-the-mobile-app>Creating the mobile app</h5><p>For the mobile app, I wanted to use F#, and there is a great F# mobile framework called Fabulous!</p><p><strong>Fabulous?</strong></p><p>If you haven&rsquo;t heard of Fabulous yet, its an F#-based MVU framework (so like Elm) for building cross-platform mobile apps, built on top of the Xamarin.Forms platform. You can read all about it <a href=https://fsprojects.github.io/Fabulous/guide.html>in the docs</a>. There&rsquo;s even an <a href=https://github.com/jimbobbennett/Awesome-Fabulous>awesome-fabulous list</a> containing cool projects that use it and some great resources.</p><p>You can create a new Fabulous app using the <code>dotnet</code> CLI. You install the template using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>dotnet new -i Fabulous.Templates
</span></span></code></pre></div><p>The create the app using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>dotnet new fabulous-app -n FabulousSantaTracker
</span></span></code></pre></div><p>This will create an F# solution with an Android app, an iOS app and a .NET standard library containing all the cross platform business logic and UI code.</p><h5 id=reading-the-json>Reading the JSON</h5><p>Processing the JSON file is easy. First I added the downloaded JSON file to the core project, setting the build action to <code>EmbeddedResource</code>. Once I had this, I added a new F# source file and declared some new types to store the data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>type Location = { Lat : <span style=color:#66d9ef>float</span>; Lng : <span style=color:#66d9ef>float</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>type Destination = 
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Arrival : <span style=color:#66d9ef>float</span>
</span></span><span style=display:flex><span>        PresentsDelivered : int64
</span></span><span style=display:flex><span>        City : <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        Region : <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        Location : Location
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>type Destinations = array&lt;Destination&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>type SantaData = { Destinations : Destinations }
</span></span></code></pre></div><p>To read the JSON data I needed to read the embedded resource, then use Newtonsoft.JSON to deserialize it (the NuGet for this is included in the Fabulous template, so nothing extra to install).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>let</span> GetResourceString fileName = 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> assembly = IntrospectionExtensions.GetTypeInfo(typedefof&lt;Destination&gt;).Assembly
</span></span><span style=display:flex><span>    use stream = assembly.GetManifestResourceStream(fileName)
</span></span><span style=display:flex><span>    use reader = <span style=color:#66d9ef>new</span> StreamReader (stream)
</span></span><span style=display:flex><span>    reader.ReadToEnd()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> AllDestinations =
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> santaData = JsonConvert.DeserializeObject&lt;SantaData&gt;(GetResourceString <span style=color:#e6db74>&#34;FabulousSantaTracker.santa_en.json&#34;</span>)
</span></span><span style=display:flex><span>    santaData.Destinations
</span></span></code></pre></div><p>The <code>GetResourceString</code> function loads the assembly and extracts the resource string from it. The name of these resource strings needs to be namespace qualified. For example the file in my project is called <code>santa_en.json</code>, and my namespace is <code>FabulousSantaTracker</code>, so the full resource name is <code>FabulousSantaTracker.santa_en.json</code>.</p><p>The last bit I needed was to convert the arrival date from milliseconds after epoch. These arrival dates are for last year (2017), so I needed to update them to the current year.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>let</span> convertFromEpoch ms =
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> d = epoch.AddMilliseconds (ms)
</span></span><span style=display:flex><span>    d.AddYears(DateTime.UtcNow.Year - d.Year)
</span></span></code></pre></div><p>Now I have my data, it&rsquo;s time to display this on a map. Fabulous uses an MVU architecture, so I need to define a model, some messages, an update function to process these messages, and a view function.</p><h6 id=defining-the-model>Defining the model</h6><p>The model is simple - it just needs Santa&rsquo;s current location by finding the latest destination in the list with an arrival time before now by working backwards through the list of destinations loaded from the JSON file. If Santa hasn&rsquo;t arrived anywhere yet then the first destination is used - this is Santa&rsquo;s workshop at the North Pole.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>let</span> currentDestination () =
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> current = TrackingData.AllDestinations |&gt; Array.tryFindBack (fun i -&gt; i.ArrivalDateTime &lt; DateTime.UtcNow)
</span></span><span style=display:flex><span>    match current with
</span></span><span style=display:flex><span>    | Some d -&gt; d
</span></span><span style=display:flex><span>    | None -&gt; TrackingData.AllDestinations |&gt; Array.item <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>type Model = 
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        CurrentDestination : Destination
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#66d9ef>init</span> () = { CurrentDestination = currentDestination() }, Cmd.none
</span></span></code></pre></div><h6 id=updating-the-map-when-santa-moves>Updating the map when Santa moves</h6><p>The easiest way to update the current destination when Santa moves is a simple timer - fire a timer every few seconds and update the current destination. This can be implemented by defining a message for a timer tick, and when this is handled in the <code>update</code> function, update the models <code>CurrentDestination</code> on every tick.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>type Msg = 
</span></span><span style=display:flex><span>    | TimerTick
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> update msg model =
</span></span><span style=display:flex><span>    match msg with
</span></span><span style=display:flex><span>    | TimerTick -&gt; { model with CurrentDestination = currentDestination() }, Cmd.none
</span></span></code></pre></div><p>This message can then be fired using a subscription to a timer. These subscriptions are functions that take the Fabulous dispatcher and are called when setting up the program.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>let</span> timerTick dispatch =
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> timer = <span style=color:#66d9ef>new</span> Timer(TimeSpan.FromSeconds(<span style=color:#ae81ff>10.</span>).TotalMilliseconds)
</span></span><span style=display:flex><span>        timer.Elapsed.Subscribe (fun _ -&gt; dispatch TimerTick) |&gt; ignore
</span></span><span style=display:flex><span>        timer.Enabled &lt;- <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        timer.Start()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> runner = 
</span></span><span style=display:flex><span>    App.program
</span></span><span style=display:flex><span>    |&gt; Program.withSubscription (fun _ -&gt; Cmd.ofSub App.timerTick)
</span></span></code></pre></div><p>Once this subscription is called, the timer is started and every 10 seconds the <code>TimerTick</code> message is dispatched. This causes the models <code>CurrentDestination</code> to be re-evaluated and the view then gets updated.</p><h6 id=drawing-the-view>Drawing the view</h6><p>Drawing the view is pretty simple. Fabulous uses a virtual UI, so your <code>view</code> function always returns a complete UI, and the internals of Fabulous compare the current with the result of the <code>view</code> call and applies the deltas to the real UI.</p><p>My view starts with a navigation page containing a content page with some emoji in the title:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>let</span> view (model: Model) dispatch =
</span></span><span style=display:flex><span>    View.NavigationPage(
</span></span><span style=display:flex><span>        pages = [
</span></span><span style=display:flex><span>            View.ContentPage(
</span></span><span style=display:flex><span>                title = <span style=color:#e6db74>&#34;🎅 Tracker&#34;</span>
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>        ]
</span></span></code></pre></div><p>It then contains a grid with 3 rows. First row for the current location, second for the number of presents, third is a map.</p><p>The label to show the location has the text set like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>View.Label(text = model.CurrentDestination.City,
</span></span></code></pre></div><p>This is one of the ways MVU differs from MVVM (the canonical design pattern for Xamarin.Forms apps) - the value for the location isn&rsquo;t bound to anything, it&rsquo;s just set using the value from the model. Updates to this value can only come from the <code>update</code> function, and after updating, the <code>view</code> function is called and the label is created with the new text. The differential update in the Fabulous framework will see this value change and update the UI.</p><p>To show the position on a map, we can use the <code>Fabulous.Maps</code> NuGet package which contains a wrapper for the Xamarin.Forms Map element. These wrappers are the way that Fabulous can provide a virtual UI, so is needed for each component you want to use in your <code>view</code> function. Once this NuGet is added, the map can be added to the view function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>View.Map(
</span></span><span style=display:flex><span>    hasZoomEnabled = <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    hasScrollEnabled = <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    requestedRegion = MapSpan.FromCenterAndRadius(model.CurrentDestination.Position, Distance.FromKilometers(<span style=color:#ae81ff>1000.0</span>)),
</span></span><span style=display:flex><span>    pins = [ 
</span></span><span style=display:flex><span>        View.Pin(
</span></span><span style=display:flex><span>            model.CurrentDestination.Position,
</span></span><span style=display:flex><span>            label = <span style=color:#e6db74>&#34;Santa&#34;</span>,
</span></span><span style=display:flex><span>            pinType = PinType.Place
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>This code creates a map, sets the region to the position of the current destination (the position is an instance of the Xamarin.Forms <code>Position</code> class using the latitude and longitude from the JSON file) and zooms out to show a radius of 1,000Km. It will also add a pin at the position so that the user can see the position more accurately.</p><h6 id=using-a-custom-map-pin>Using a custom map pin</h6><p>This code so far shows where Santa is, and updates the UI when he moves, but doesn&rsquo;t look the best as the pin is, well just a map pin. It would be better to show Santa himself.</p><p>To do this I added some images to the iOS and Android apps of Santa, drawn by using the Santa emoji. To show these as a custom pin means I need to dive down into some platform specific code. One of the upsides of Xamarin.Forms, the underlying technology for Fabulous, is that you have access to the native UI components, so can update them as if your app was a fully native swift/java app.</p><div class=image-div style=max-width:68px><p><img src=Santa.png alt="Santa map pin image"></p></div><p>Accessing this native code involves the use of custom renderers - custom code to help Fabulous renderer the native controls. Customizing the map means creating my own <code>SantaMap</code> class that derives from the Forms <code>Map</code> class.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>type SantaMap() =
</span></span><span style=display:flex><span>    inherit Xamarin.Forms.Maps.Map()
</span></span></code></pre></div><p>You can see the full implementation of this on <a href=https://github.com/jimbobbennett/FabulousSantaTracker/blob/master/FabulousSantaTracker/SantaMap.fs>GitHub</a>. There is a lot of code here, but is lifted from the original maps implementation so was minimal work. Hopefully in the future this will be easier!</p><p>Once this was in place, I needed to create the custom renderers to draw different pins. The Android one is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>type SantaMapRenderer(context : Context) =
</span></span><span style=display:flex><span>    inherit MapRenderer(context)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>this</span>.CreateMarker(pin : Pin) =
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>new</span> MarkerOptions()).SetPosition(<span style=color:#66d9ef>new</span> LatLng(pin.Position.Latitude, pin.Position.Longitude))
</span></span><span style=display:flex><span>                             .SetTitle(pin.Label)
</span></span><span style=display:flex><span>                             .SetIcon(BitmapDescriptorFactory.FromResource(Resources.Drawable.Santa))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>module Export_SantaMapRenderer =
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [&lt;assembly: ExportRenderer(typeof&lt;SantaMap&gt;, typeof&lt;SantaMapRenderer&gt;) &gt;]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>do</span> ()
</span></span></code></pre></div><p>Pretty simple - it uses the existing renderer and overrides the code to create the pins to use my Santa image. These renderers need to be registered with the framework to be used, and this can be done using the <code>ExportRenderer</code> attributes.</p><h5 id=fin>Fin!</h5><p>That&rsquo;s all there is to this - a Santa tracker built using Fabulous. You can find all the code on GitHub here: <a href=https://github.com/jimbobbennett/FabulousSantaTracker>https://github.com/jimbobbennett/FabulousSantaTracker</a></p><p>To build this app for iOS, just build it and run it and on Christmas eve watch for where Santa is. Android is a bit more effort as it needs a Google Maps key. You can find instructions on getting one in the <a href="https://docs.microsoft.com/xamarin/android/platform/maps-and-location/maps/obtaining-a-google-maps-api-key?WT.mc_id=santa-blog-jabenn">Xamarin Docs</a>. Once you have your key, add it to the <code>AndroidManifest.xml</code> file and track Santa!</p><p>Merry Christmas!</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#building-the-santa-tracker>Building the Santa tracker</a></li></ul></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/technology target=_blank>Technology</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/xamarin target=_blank>xamarin</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/xamarin.forms target=_blank>xamarin.forms</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/f target=_blank>f#</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/fabulous target=_blank>fabulous</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/santa target=_blank>santa</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://jimbobbennett.dev/blogs/fabulous-santa-tracker/",this.page.identifier="ef4fede81d7c5ebf63c5e8aee7252545"};(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://jimbobbennett.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2025 All Rights Reserved</div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js integrity=sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13 crossorigin=anonymous></script><script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script>function createCopyButton(e,t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy",n.addEventListener("click",()=>copyCodeToClipboard(n,e,t)),addCopyButtonToDom(n,e)}async function copyCodeToClipboard(e,t,n){const s=t.querySelector("pre > code").innerText;try{n.writeText(s)}finally{codeWasCopied(e)}}function codeWasCopied(e){e.blur(),e.innerText="Copied!",setTimeout(function(){e.innerText="Copy"},2e3)}function addCopyButtonToDom(e,t){t.insertBefore(e,t.firstChild);const n=document.createElement("div");n.className="highlight-wrapper",t.parentNode.insertBefore(n,t),n.appendChild(t)}if(navigator&&navigator.clipboard)document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,navigator.clipboard));else{var script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",script.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",script.crossOrigin="anonymous",script.onload=function(){addCopyButtons(clipboard)},document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,script)),document.body.appendChild(script)}</script></body></html>