<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon href=/fav.png type=image/png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="Subscribe to messages from an iRobot Create3 using ROS"><meta property="og:description" content="Learn how to subscribe to messages sent by an iRobot Create3 to a connected Raspberry Pi"><meta property="og:type" content="article"><meta property="og:url" content="https://jimbobbennett.dev/blogs/irobot-create3-subscribe-to-messages/"><meta property="og:image" content="https://jimbobbennett.dev/blogs/irobot-create3-subscribe-to-messages/banner.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2022-09-22T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-22T00:00:00+00:00"><meta property="og:site_name" content="JimBobBennett"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jimbobbennett.dev/blogs/irobot-create3-subscribe-to-messages/banner.png"><meta name=twitter:title content="Subscribe to messages from an iRobot Create3 using ROS"><meta name=twitter:description content="Learn how to subscribe to messages sent by an iRobot Create3 to a connected Raspberry Pi"><meta name=twitter:site content="@jimbobbennett"><meta name=twitter:creator content="@jimbobbennett"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><link rel="shortcut icon" type=image/png href=/fav.png><link rel="shortcut icon" sizes=192x192 href=/fav.png><link rel=apple-touch-icon href=/fav.png><link rel=alternate type=application/rss+xml href=https://jimbobbennett.dev/index.xml title=JimBobBennett><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","dctc2ydykv")</script><script data-goatcounter=https://jimbobbennett.goatcounter.com/count async src=//gc.zgo.at/count.js></script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#000;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#000000;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{background-color:#000;font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content="Learn how to subscribe to messages sent by an iRobot Create3 to a connected Raspberry Pi"><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=/css/single.css><link rel=stylesheet href=/css/projects.css media=all><script defer src=/fontawesome-5/all-5.15.4.js></script><title>Subscribe to messages from an iRobot Create3 using ROS | JimBobBennett</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
JimBobBennett
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/ aria-label=home>Home</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Recent Highlights</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/videos title=Videos>Videos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/livestreams title=Livestreams>Livestreams</a></li><li class="nav-item navbar-text"><a class=nav-link href=/conferences title=Conferences>Conferences</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul></div></div></nav></header><div id=content><section id=projects><div class="container pt-5" id=list-page><div class="row justify-content-center px-3 px-md-5"><h1 class="text-left pb-2 content">Subscribe to messages from an iRobot Create3 using ROS</h1><div class="text-left content"><a href=https://linkedin.com/in/jimbobbennett>Jim Bennett
</a><small>|</small>
Sep 22, 2022</div></div></div></section><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><article class="page-content p-2"><p><img src=banner.png alt="An iRobot create with a Raspberry Pi"></p><p>In my <a href=../irobot-create3-connect-a-pi/>last post</a> I showed how I connected a Raspberry Pi to an iRobot Crete3 robot. In this post I show how to subscribe to messages sent by the robot to the Pi using <a href=https://github.com/ros2/rclpy>rclpy</a>, the ROS Python library.</p><blockquote><p>One downside to ROS is that the documentation needs some love. It covers in great detail how to do things, but not the why, so anything I write in this post is based off my understanding from my couple of days working with ROS, and could be completely wrong! If so, please correct me in the comments.</p></blockquote><h2 id=ros2-applications>ROS2 applications</h2><p>ROS applications are based around a graph of <em>nodes</em> that can publish and subscribe to messages on different topics. Each node can be a separate process, can run on a separate machine connected to the network, or you can have multiple nodes running in the same process.</p><p>The robot is a node that published messages on various topics, and can listen to messages on other topics. If you read the last post, you will know that the robot has a range of topics that you can see by running <code>ros2 topic list</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/battery_state
</span></span><span style=display:flex><span>/cmd_audio
</span></span><span style=display:flex><span>/cmd_lightring
</span></span><span style=display:flex><span>/cmd_vel
</span></span><span style=display:flex><span>/dock
</span></span><span style=display:flex><span>/hazard_detection
</span></span><span style=display:flex><span>/imu
</span></span><span style=display:flex><span>/interface_buttons
</span></span><span style=display:flex><span>/ir_intensity
</span></span><span style=display:flex><span>/ir_opcode
</span></span><span style=display:flex><span>/kidnap_status
</span></span><span style=display:flex><span>/mobility_monitor/transition_event
</span></span><span style=display:flex><span>/mouse
</span></span><span style=display:flex><span>/odom
</span></span><span style=display:flex><span>/parameter_events
</span></span><span style=display:flex><span>/robot_state/transition_event
</span></span><span style=display:flex><span>/rosout
</span></span><span style=display:flex><span>/slip_status
</span></span><span style=display:flex><span>/static_transform/transition_event
</span></span><span style=display:flex><span>/stop_status
</span></span><span style=display:flex><span>/tf
</span></span><span style=display:flex><span>/tf_static
</span></span><span style=display:flex><span>/wheel_status
</span></span><span style=display:flex><span>/wheel_ticks
</span></span><span style=display:flex><span>/wheel_vels
</span></span></code></pre></div><p>The majority of these topics contain sensor data published by the robot with the exception of the 3 <code>cmd</code> topics - <code>cmd_audio</code>, <code>cmd_lightring</code> and <code>cmd_vel</code>. You can publish data to these topics to play audio, configure the light ring, or move the robot.</p><p>Topics are designed to have continuous streams of data. For example if you subscribe to the <code>/battery_state</code> topic, you will get a continuous stream of battery data updated every few seconds.</p><p>Robots can also have services and actions. These are abstractions that make it easier to program a robot. Services are designed for quick calls to do calculations or get states, maybe to query a sensor or take advantage of onboard processing such as a built-in image processor. Actions are commands you can send to a robot to do something, for example with the Create3 there are actions to dock and undock, so drive the robot to the docking station and connect it to recharge, or drive off the docking station.</p><p>You can test the actions using the following run from your Raspberry Pi.</p><p>Run this command to undock the robot:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ros2 action send_goal /undock irobot_create_msgs/action/Undock <span style=color:#e6db74>&#34;{}&#34;</span>
</span></span></code></pre></div><p>Then run this command to re-dock the robot:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ros2 action send_goal /dock irobot_create_msgs/action/DockServo <span style=color:#e6db74>&#34;{}&#34;</span>
</span></span></code></pre></div><p>All the topics, services and actions are documented in the <a href=https://iroboteducation.github.io/create3_docs/api/ros2/>iRobot ROS2 API docs</a>.</p><h2 id=subscribing-to-messages-using-rclpy>Subscribing to messages using rclpy</h2><p><a href=https://github.com/ros2/rclpy>rclpy</a> is the ROS Python library and has all the functionality you need to interact with a robot. But there is a catch - you can&rsquo;t just create a Python script and use rclpy, you have to build a ROS2 application inside a ROS2 workspace.</p><h3 id=ros2-workspaces>ROS2 workspaces</h3><p>ROS applications are compiled inside a workspace - a folder with a predefined structure containing your code. You write your code, compile a ROS application using a tool called <a href=https://colcon.readthedocs.io/en/released/><code>colcon</code></a>, configure your environment by sourcing a file created by the build, then run your code using ROS.</p><p>There is a core ROS workspace provided by the install, known as an underlay, and you can have multiple versions installed. You then stack additional workspaces on top with your own code, called overlays. No, I still don&rsquo;t understand this and I can&rsquo;t find good documentation to explain why.</p><p>To use Python to developer ROS applications, you need to create a Python package inside your workspace, and this package contains the code for your executable. This is similar to creating a pip package, with <code>setup.py</code> and <code>setup.cfg</code> files, but with the addition of a <code>package.xml</code> file to help <code>colcon</code> build the package.</p><p>You can find an example as a template repo on my GitHub at <a href=https://github.com/jimbobbennett/irobot_create3_ros_workspace>github.com/jimbobbennett/irobot_create3_ros_workspace</a>. You can use this as a template to create your own workspace.</p><h3 id=structure-of-the-workspace>Structure of the workspace</h3><p>You can see the structure detailed blow by creating a new repo using the <a href=https://github.com/jimbobbennett/irobot_create3_ros_workspace>github.com/jimbobbennett/irobot_create3_ros_workspace</a> template repo.</p><p>The workspace consists of a <code>src</code> folder where the source code for your application lives. This <code>src</code> folder contains the Python package as a folder. This package folder contains <code>setup.py</code> and <code>setup.cfg</code> files. These files define any extra pip packages needed by your code, the location of the <code>package.xml</code> file needed by <code>colcon</code>, and the entry point for the ROS application.</p><p>The <code>package.xml</code> file details the ROS package, including dependencies on other packages. These include the ROS packages that define message formats. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;depend&gt;</span>rclpy<span style=color:#f92672>&lt;/depend&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;depend&gt;</span>geometry_msgs<span style=color:#f92672>&lt;/depend&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;depend&gt;</span>sensor_msgs<span style=color:#f92672>&lt;/depend&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;depend&gt;</span>irobot_create_msgs<span style=color:#f92672>&lt;/depend&gt;</span>
</span></span></code></pre></div><p>This dependency list shows a dependency on the <code>rclpy</code> ROS python package, as well as the packages for the generic geometry messages used to control a robot (<code>geometry_msgs</code>), generic sensor messages used to gather standard sensor data such as battery state (<code>sensor_msgs</code>), and the specific messages for the iRobot Create3 (<code>irobot_create_msgs</code>).</p><p>Inside the package folder is a folder containing your code, along with a <code>resource</code> folder with a single file with the same name as the folder containing your code. No idea why, but it seems to be needed&mldr;</p><p>The code folder is a Python package, and needs an <code>__init__.py</code> file, though this can be empty. Inside the code folder is another folder with your actual package code, again containing an <code>__init__.py</code> file that can be empty, and a code file that contains your <code>main</code> method, along with any other code files you need. Your <code>setup.py</code> needs to point to this <code>main</code> method as its entry point.</p><h3 id=subscribing-to-messages>Subscribing to messages</h3><p>If you look at the template repo, particularly the <a href=https://github.com/jimbobbennett/irobot_create3_ros_workspace/blob/main/src/irobot_create3_example_py/irobot_create3_example_py/control_robot/control_robot.py><code>control_robot.py</code> file</a> you will see an example <code>main</code> method.</p><p>This method starts by initializing the ROS application with <code>rclpy.init(args=args)</code>, passing any args sent to the application. It then creates a subscriber, in this case a subscriber to the battery state to get the percentage charge in the robots battery.</p><p>Subscribers are ROS nodes - ROS applications are graphs of nodes that publish and subscribe messages, and your application can contain one oe more nodes, and nodes can publish and subscribe to as many topics as needed. In the template repo, the node in question is a battery state subscriber, implemented in the <code>BatteryStateSubscriber</code> class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BatteryStateSubscriber</span>(Node):
</span></span></code></pre></div><p>All nodes need to derive from the <code>rclpy.node.Node</code> base class, and this has functionality to manage subscriptions, logging, execution and more.</p><p>In the <code>__init__</code> method, the node creates a subscription to the battery state:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>self<span style=color:#f92672>.</span>subscription_battery_state <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>create_subscription(
</span></span><span style=display:flex><span>    BatteryState,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/battery_state&#39;</span>,
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>get_battery_state,
</span></span><span style=display:flex><span>    qos_profile)
</span></span></code></pre></div><p>The <code>create_subscription</code> method on the base <code>Node</code> class takes a number of options:</p><ul><li><code>BatteryState</code> - This is the message type. Messages can be raw strings, or typed. The <code>sensor_msgs</code>, <code>sensor_msgs</code> and <code>irobot_create_msgs</code> packages described earlier contain the types for these messages. In this case, we want battery information, so the type is <code>sensor_msgs.msg.BatteryState</code>, a ROS defined message for battery states.</li><li><code>'/battery_state'</code> - This is the topic name used by the robot to publish the battery state</li><li><code>self.get_battery_state</code> - This is the callback method called whenever a message is received by the subscription</li><li><code>qos_profile</code> - This is the quality of service profile defined by the subscriber. This is covered <a href=#quality-of-service>below</a>.</li></ul><p>Once this subscription is created, every time a message is published on this topic, the callback method is called. The callback method has this signature:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_battery_state</span>(self, msg: BatteryState):
</span></span></code></pre></div><p>The <code>msg</code> passed is an instance of <code>sensor_msgs.msg.BatteryState</code>, so the properties on this message can be queried to get the state of the battery. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>self<span style=color:#f92672>.</span>get_logger()<span style=color:#f92672>.</span>info(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Battery percentage:</span><span style=color:#e6db74>{:.0%}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(msg<span style=color:#f92672>.</span>percentage))
</span></span></code></pre></div><p>uses the logger on the node to log out the current percentage charge on the battery.</p><pre tabindex=0><code class=language-output data-lang=output>[INFO] [1663974929.958794823] [battery_state_subscriber]: Subscribing to battery state
[INFO] [1663974930.072528455] [battery_state_subscriber]: Subscribed!
[INFO] [1663974931.658984386] [battery_state_subscriber]: Battery percentage:98%
</code></pre><h3 id=quality-of-service>Quality of service</h3><p>ROS ia based around sending messages to topics, and can be considered to be a message broker. Like all message brokers, there is a quality of service (QoS) that defines when a topic can be considered stale, how messages are stored if a subscriber is offline, things like that. You can read more in the <a href=https://docs.ros.org/en/galactic/Concepts/About-Quality-of-Service-Settings.html>ROS quality of service documentation</a>, but the important point is that the subscriber <strong>must</strong> subscribe with the same quality of service settings as the publisher or no messages will be received.</p><p>You can find the QoS settings from a topic using this command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ros2 topic info -v &lt;topic&gt;
</span></span></code></pre></div><p>Where <code>&lt;topic></code> is the name of the topic to query. In the case of the <code>/battery_state</code> topic, the results of this call are:</p><pre tabindex=0><code class=language-output data-lang=output>Type: sensor_msgs/msg/BatteryState

Publisher count: 1

Node name: robot_state
Node namespace: /
Topic type: sensor_msgs/msg/BatteryState
Endpoint type: PUBLISHER
GID: 01.0f.34.90.5c.09.ad.d2.01.00.00.00.00.01.4f.03.00.00.00.00.00.00.00.00
QoS profile:
    Reliability: BEST_EFFORT
    Durability: VOLATILE
    Lifespan: 9223372036854775807 nanoseconds
    Deadline: 9223372036854775807 nanoseconds
    Liveliness: AUTOMATIC
    Liveliness lease duration: 9223372036854775807 nanoseconds

Subscription count: 0
</code></pre><p>The relevant details are the <code>QoS profile</code>, particularly the <code>Reliability</code>, <code>Durability</code>, and the <code>Liveliness</code>. To subscribe to these messages, the subscriber needs to create a <code>QoSProfile</code> object with the same settings, and pass this to the <code>create_subscription</code> call:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> rclpy.qos <span style=color:#f92672>import</span> QoSProfile, ReliabilityPolicy, LivelinessPolicy, DurabilityPolicy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>qos_profile <span style=color:#f92672>=</span> QoSProfile(
</span></span><span style=display:flex><span>            reliability<span style=color:#f92672>=</span>ReliabilityPolicy<span style=color:#f92672>.</span>BEST_EFFORT,
</span></span><span style=display:flex><span>            liveliness<span style=color:#f92672>=</span>LivelinessPolicy<span style=color:#f92672>.</span>AUTOMATIC,
</span></span><span style=display:flex><span>            durability<span style=color:#f92672>=</span>DurabilityPolicy<span style=color:#f92672>.</span>VOLATILE,
</span></span><span style=display:flex><span>            depth<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>self<span style=color:#f92672>.</span>subscription_battery_state <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>create_subscription(
</span></span><span style=display:flex><span>    BatteryState,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/battery_state&#39;</span>,
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>get_battery_state,
</span></span><span style=display:flex><span>    qos_profile)
</span></span></code></pre></div><blockquote><p>If you subscribe to a ROS topic and don&rsquo;t receive any messages, check your QoS settings</p></blockquote><h2 id=running-the-ros-application>Running the ROS application</h2><p>Once you have your ROS workspace with your code, you can run it.</p><p>The first step is to build the workspace:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>colcon build
</span></span></code></pre></div><p>This command builds the package and creates 3 directories:</p><ul><li><code>build</code> - This contains the compiled Python package</li><li><code>install</code> - This contains the application that can be installed and run on another device</li><li><code>log</code> - This contains the build logs</li></ul><p>To run the code, first you need to source an install script to set the environment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>source ./install/local_setup.sh
</span></span></code></pre></div><p>Finally run the ROS package:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ros2 run &lt;package name&gt; &lt;application&gt;
</span></span></code></pre></div><p>For example, if you use the template repo mentioned earlier in this post, you can run with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ros2 run irobot_create3_example_py control_robot
</span></span></code></pre></div><p>This will run the <code>control_robot</code> module in the <code>irobot_create3_example_py</code> package, subscribing to the battery state and printing it to the console:</p><pre tabindex=0><code class=language-output data-lang=output>ubuntu@ubuntu:~/irobot_create3_ros_workspace$ ros2 run irobot_create3_example_py control_robot
[INFO] [1663974929.958794823] [battery_state_subscriber]: Subscribing to battery state
[INFO] [1663974930.072528455] [battery_state_subscriber]: Subscribed!
</code></pre></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#ros2-applications>ROS2 applications</a></li><li><a href=#subscribing-to-messages-using-rclpy>Subscribing to messages using rclpy</a><ul><li><a href=#ros2-workspaces>ROS2 workspaces</a></li><li><a href=#structure-of-the-workspace>Structure of the workspace</a></li><li><a href=#subscribing-to-messages>Subscribing to messages</a></li><li><a href=#quality-of-service>Quality of service</a></li></ul></li><li><a href=#running-the-ros-application>Running the ROS application</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/irobot target=_blank>irobot</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/ros target=_blank>ros</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/ros2 target=_blank>ros2</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/raspberry-pi target=_blank>raspberry-pi</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/create3 target=_blank>create3</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/qos target=_blank>QoS</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://jimbobbennett.dev/blogs/irobot-create3-subscribe-to-messages/",this.page.identifier="cd81fd72dfa3e1441e9b156b2aa26c03"};(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://jimbobbennett.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2023 All Rights Reserved</div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js integrity=sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13 crossorigin=anonymous></script><script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script>function createCopyButton(e,t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy",n.addEventListener("click",()=>copyCodeToClipboard(n,e,t)),addCopyButtonToDom(n,e)}async function copyCodeToClipboard(e,t,n){const s=t.querySelector("pre > code").innerText;try{n.writeText(s)}finally{codeWasCopied(e)}}function codeWasCopied(e){e.blur(),e.innerText="Copied!",setTimeout(function(){e.innerText="Copy"},2e3)}function addCopyButtonToDom(e,t){t.insertBefore(e,t.firstChild);const n=document.createElement("div");n.className="highlight-wrapper",t.parentNode.insertBefore(n,t),n.appendChild(t)}if(navigator&&navigator.clipboard)document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,navigator.clipboard));else{var script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",script.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",script.crossOrigin="anonymous",script.onload=function(){addCopyButtons(clipboard)},document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,script)),document.body.appendChild(script)}</script></body></html>