<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon href=/fav.png type=image/png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="Are you where you should be? Checking Geofences using Azure Maps"><meta property="og:description" content="A Geofence is a virtual boundary defined using an area on a map. Azure Maps has tools for checking if a coordinate is inside that Geofence. This post looks at how to do these checks."><meta property="og:type" content="article"><meta property="og:url" content="https://jimbobbennett.dev/blogs/are-you-where-you-should-be-checking-geofences-using-azure-maps/"><meta property="og:image" content="https://jimbobbennett.dev/blogs/are-you-where-you-should-be-checking-geofences-using-azure-maps/banner.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2019-09-10T00:08:58+00:00"><meta property="article:modified_time" content="2019-09-10T00:08:58+00:00"><meta property="og:site_name" content="JimBobBennett"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jimbobbennett.dev/blogs/are-you-where-you-should-be-checking-geofences-using-azure-maps/banner.png"><meta name=twitter:title content="Are you where you should be? Checking Geofences using Azure Maps"><meta name=twitter:description content="A Geofence is a virtual boundary defined using an area on a map. Azure Maps has tools for checking if a coordinate is inside that Geofence. This post looks at how to do these checks."><meta name=twitter:site content="@jimbobbennett"><meta name=twitter:creator content="@jimbobbennett"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><link rel="shortcut icon" type=image/png href=/fav.png><link rel="shortcut icon" sizes=192x192 href=/fav.png><link rel=apple-touch-icon href=/fav.png><link rel=alternate type=application/rss+xml href=https://jimbobbennett.dev/index.xml title=JimBobBennett><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","dctc2ydykv")</script><script data-goatcounter=https://jimbobbennett.goatcounter.com/count async src=//gc.zgo.at/count.js></script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#000;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#000000;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{background-color:#000;font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=/css/single.css><link rel=stylesheet href=/css/projects.css media=all><script defer src=/fontawesome-5/all-5.15.4.js></script><title>Are you where you should be? Checking Geofences using Azure Maps | JimBobBennett</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
JimBobBennett
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/ aria-label=home>Home</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Recent Highlights</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/videos title=Videos>Videos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/podcasts title=Podcasts>Podcasts</a></li><li class="nav-item navbar-text"><a class=nav-link href=/livestreams title=Livestreams>Livestreams</a></li><li class="nav-item navbar-text"><a class=nav-link href=/conferences title=Conferences>Conferences</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul></div></div></nav></header><div id=content><section id=projects><div class="container pt-5" id=list-page><div class="row justify-content-center px-3 px-md-5"><h1 class="text-left pb-2 content">Are you where you should be? Checking Geofences using Azure Maps</h1><div class="text-left content"><a href=https://linkedin.com/in/jimbobbennett>Jim Bennett
</a><small>|</small>
Sep 10, 2019</div></div></div></section><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><article class="page-content p-2"><p><strong>A Geofence is a virtual boundary defined using an area on a map. Azure Maps has tools for checking if a coordinate is inside that Geofence. This post looks at how to do these checks.</strong></p><figure><img src=stephen-monroe-yg8Cz-i5U30-unsplash.jpg></figure><p>There are many use cases for tracking where an item is, and if it moves into or out of a defined location. One great example is legal compliance - for example has an asset crossed an international or state boundary, is a vehicle on roads that require road tax to be paid (for example <a href=https://www.nzta.govt.nz/vehicles/licensing-rego/road-user-charges/>New Zealand&rsquo;s RUC</a>) or is a ship near a port.</p><p>One use case I&rsquo;ve been thinking about recently is wildlife tracking. I&rsquo;m building a sample app that can be used to track animal sightings including a GPS device that could be attached to an animal to provide 24/7 tracking (I&rsquo;m not really going to put it on a real animal, this is just for demo purposes, so will be using a plushie bear). As well as knowing where an animal is, it would also be good to have an alert if the animal enters certain areas, for example if a bear goes near a center of population. This post shows how to create and check geofences using Azure Maps.</p><h2 id=getting-started>Getting started</h2><ul><li>Start by signing up for Azure if you don&rsquo;t have an account:If you are a student, sign up at <a href="https://azure.microsoft.com/free/students/?WT.mc_id=azuremaps-blog-jabenn">azure.microsoft.com/free/students</a> to get US$100 of free credit and free services for a year.Otherwise sign up at <a href="https://azure.microsoft.com/free/?WT.mc_id=azuremaps-blog-jabenn">azure.microsoft.com/free</a> to get US$200 of credit for 30 days and a year of free services.</li><li>Sign into Azure and create an Azure Maps resource by following <a href="https://ms.portal.azure.com/?WT.mc_id=azuremaps-blog-jabenn%2F#create/Microsoft.Maps">this link</a>.</li></ul><figure><img src=2019-09-06_16-51-33.png></figure><h2 id=defining-a-geofence>Defining a Geofence</h2><p>Once you have an Azure Maps resource you need to define a geofence. These are defined using GeoJSON - a JSON document designed for geographic information. TO create a simple geofence for the Seattle/Redmond area, you would define it like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;Feature&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>       <span style=color:#f92672>&#34;geometryId&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>     },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;geometry&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;Polygon&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;coordinates&#34;</span>: [
</span></span><span style=display:flex><span>            [
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>-122.41864</span>, <span style=color:#ae81ff>47.54548</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>-122.41864</span>, <span style=color:#ae81ff>47.70502</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>-122.00867</span>, <span style=color:#ae81ff>47.70502</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>-122.00867</span>, <span style=color:#ae81ff>47.54548</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                [
</span></span><span style=display:flex><span>                    <span style=color:#ae81ff>-122.41864</span>, <span style=color:#ae81ff>47.54548</span>
</span></span><span style=display:flex><span>                ]
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This defines a geometric feature, that is a polygon using the coordinates given, with the last coordinate being the same as the first to close the shape - in this case a rectangle.</p><figure><img src=response.png></figure><p>You can do a lot with GeoJson, and you can read more in the <a href="https://docs.microsoft.com/azure/azure-maps/geofence-geojson/?WT.mc_id=azuremaps-blog-jabenn">GeoJSON docs</a>.</p><p>To set the geofence, you need to send this JSON to a call to the Azure Maps REST API. There aren&rsquo;t any SDKs available for this service yet, but hopefully should be some soon.</p><p>Uploading a geofence needs a couple of calls - you make one call to upload which returns an endpoint that stores the data, then you call that endpoint to get back an Id you use to access the geofence from later calls.</p><p>The first REST call is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>https://atlas.microsoft.com/mapData/upload?
</span></span><span style=display:flex><span>        subscription-key<span style=color:#f92672>={</span>subscription-key<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        &amp;api-version<span style=color:#f92672>=</span>1.0
</span></span><span style=display:flex><span>        &amp;dataFormat<span style=color:#f92672>=</span>geojson
</span></span></code></pre></div><p>You will need to replace <code>{subscription-key}</code> with your primary or secondary key from the <em>Shared Key Authentication</em> section of the <em>Settings -> Authentication</em> tab in the map blade in the Azure portal.</p><figure><img src=2019-09-09_16-13-17.png></figure><p>The body of the request will need to be set to <code>application/json</code> and contain the GeoJSON for your geofence.</p><p>When you call this end point you should get back a status of <strong>202 - Accepted</strong>. In the headers will be a <code>Location</code> containing an end point to call to get the Id of the geofence.</p><figure><img src=2019-09-09_16-23-18.png></figure><p>To get the Id, call the <code>Location</code> endpoint, adding your subscription key as an additional parameter:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>https://atlas.microsoft.com/mapData/<span style=color:#f92672>{</span>location<span style=color:#f92672>}</span>/status?api-version<span style=color:#f92672>=</span>1.0
</span></span><span style=display:flex><span>        &amp;subscription-key<span style=color:#f92672>={</span>subscription-key<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>This will return a status of <strong>201 - Created</strong>, with a body containing a JSON document with a single field - <code>"udId"</code>, the unique Id of the geofence.</p><h2 id=testing-if-a-coordinate-is-in-the-geofence>Testing if a coordinate is in the geofence</h2><p>The purpose of a geofence is to know when something goes in or out of it. This is done by making a call to another REST API, giving it the udId of the geofence, and the latitude and longitude of the coordinate you want to check.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>https://atlas.microsoft.com/spatial/geofence/json
</span></span><span style=display:flex><span>        ?subscription-key<span style=color:#f92672>={</span>subscription-key<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        &amp;api-version<span style=color:#f92672>=</span>1.0
</span></span><span style=display:flex><span>        &amp;udId<span style=color:#f92672>={</span>udId<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        &amp;lat<span style=color:#f92672>={</span>latitude<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        &amp;lon<span style=color:#f92672>=</span>-<span style=color:#f92672>{</span>longitude<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        &amp;deviceId<span style=color:#f92672>={</span>device-id<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>In the above call replace <code>{subscription-key}</code> with your Azure Maps shared access key, <code>{udId}</code> with the udId from the second REST call, <code>{latitude}</code> and <code>{longitude}</code> with the latitude and longitude of the coordinate you want to check. The final parameter you need to set is <code>{device-id}</code>, and this needs to be set to an Id for the device that the coordinates come from. This device id doesn&rsquo;t seem to be used for anything, so can be set to whatever you want, but it must be set otherwise you get an error.</p><p>The result of this call is a JSON document containing details about the location of the coordinates relative to the geofence.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;geometries&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;deviceId&#34;</span>: <span style=color:#e6db74>&#34;device&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;udId&#34;</span>: <span style=color:#e6db74>&#34;xxxxxxxxx&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;geometryId&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;distance&#34;</span>: <span style=color:#ae81ff>-999.0</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;nearestLat&#34;</span>: <span style=color:#ae81ff>47.54548</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;nearestLon&#34;</span>: <span style=color:#ae81ff>-122.2</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;expiredGeofenceGeometryId&#34;</span>: [],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;invalidPeriodGeofenceGeometryId&#34;</span>: []
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This JSON document returns the device and udId values passed in, useful if you want to pass this on to some form of notification system. It also gives a distance and the nearest latitude and longitude.</p><p>One thing to be aware of is GPS is not always exact - although calculations can be exact, coordinates are not always totally accurate. GPS sensors are at best accurate to a few meters, so a device could be inside the geofence but detected outside. The <code>distance</code> value takes this into consideration:</p><ul><li>Positive distance values are outside the geofence, negative are inside.</li><li>If the location is within a short distance (default of 50m and referred to as a <em>search buffer)</em> of the edge of the geofence, the <code>distance</code> will be the distance to the geofence in meters.</li><li>If the device is further away from the edge, the value will be <code>999</code> if outside, <code>-999</code> inside.</li><li>The search buffer can be configured in the REST call by setting the <code>searchBuffer</code> parameter to a value in meters from <code>0</code> to <code>500</code>. If this is not set, the default of 50m is used.</li></ul><p>When triggering alerts based off being close to the edge of a geofence you should take other information into consideration - for example if the GSP sensor is on a road going device, is the nearest road inside the geofence?</p><p>The <code>nearestLat</code> and <code>nearestLon</code> values give the point on the geofence that is nearest to the device - useful for example if you are tracking animals in an enclosed space, this might be where there is hole in the fence!</p><h1 id=learn-more>Learn more</h1><p>If you want to learn more, check out these links:</p><ul><li><a href="https://docs.microsoft.com/azure/azure-maps/?WT.mc_id=azuremaps-blog-jabenn">Azure maps docs</a></li><li><a href="https://docs.microsoft.com/rest/api/maps/?WT.mc_id=azuremaps-blog-jabenn">Azure Maps REST API docs</a></li></ul></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#getting-started>Getting started</a></li><li><a href=#defining-a-geofence>Defining a Geofence</a></li><li><a href=#testing-if-a-coordinate-is-in-the-geofence>Testing if a coordinate is in the geofence</a></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/technology target=_blank>technology</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/spatial target=_blank>Spatial</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/maps target=_blank>Maps</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/azure target=_blank>azure</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/rest target=_blank>REST</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://jimbobbennett.dev/blogs/are-you-where-you-should-be-checking-geofences-using-azure-maps/",this.page.identifier="ed666b10edd0ef85956543f3fc7eb66f"};(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://jimbobbennett.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2024 All Rights Reserved</div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js integrity=sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13 crossorigin=anonymous></script><script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script>function createCopyButton(e,t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy",n.addEventListener("click",()=>copyCodeToClipboard(n,e,t)),addCopyButtonToDom(n,e)}async function copyCodeToClipboard(e,t,n){const s=t.querySelector("pre > code").innerText;try{n.writeText(s)}finally{codeWasCopied(e)}}function codeWasCopied(e){e.blur(),e.innerText="Copied!",setTimeout(function(){e.innerText="Copy"},2e3)}function addCopyButtonToDom(e,t){t.insertBefore(e,t.firstChild);const n=document.createElement("div");n.className="highlight-wrapper",t.parentNode.insertBefore(n,t),n.appendChild(t)}if(navigator&&navigator.clipboard)document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,navigator.clipboard));else{var script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",script.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",script.crossOrigin="anonymous",script.onload=function(){addCopyButtons(clipboard)},document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,script)),document.body.appendChild(script)}</script></body></html>