<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=icon href=/fav.png type=image/png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora&family=Muli:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto&family=Muli:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:title" content="Updating your google-service.json from an AppCenter environment variable"><meta property="og:description" content="I&rsquo;ve been working on an app that needs push notifications, but also needs to be open source. This led me to a problem - the google-services.json file. This file is needed to sign up for Firebase messaging to implement push on Android, but it also contains my API keys, values I do NOT want to be public.
So - what to do?
Well I&rsquo;m building and distributing my app using AppCenter and the build configuration contains a couple of useful settings that I can take advantage of - build scripts and environment variables."><meta property="og:type" content="article"><meta property="og:url" content="https://jimbobbennett.dev/blogs/updating-your-google-service-json-from-an-appcenter-environment-variable/"><meta property="og:image" content="https://jimbobbennett.dev/blogs/updating-your-google-service-json-from-an-appcenter-environment-variable/banner.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2018-09-25T14:15:50+00:00"><meta property="article:modified_time" content="2018-09-25T14:15:50+00:00"><meta property="og:site_name" content="JimBobBennett"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jimbobbennett.dev/blogs/updating-your-google-service-json-from-an-appcenter-environment-variable/banner.png"><meta name=twitter:title content="Updating your google-service.json from an AppCenter environment variable"><meta name=twitter:description content="I&rsquo;ve been working on an app that needs push notifications, but also needs to be open source. This led me to a problem - the google-services.json file. This file is needed to sign up for Firebase messaging to implement push on Android, but it also contains my API keys, values I do NOT want to be public.
So - what to do?
Well I&rsquo;m building and distributing my app using AppCenter and the build configuration contains a couple of useful settings that I can take advantage of - build scripts and environment variables."><meta name=twitter:site content="@jimbobbennett"><meta name=twitter:creator content="@jimbobbennett"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><link rel="shortcut icon" type=image/png href=/fav.png><link rel="shortcut icon" sizes=192x192 href=/fav.png><link rel=apple-touch-icon href=/fav.png><link rel=alternate type=application/rss+xml href=https://jimbobbennett.dev/index.xml title=JimBobBennett><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","dctc2ydykv")</script><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#000;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#000000;--secondary-background-color-dark:#212529;--primary-color-dark:#ffffff;--secondary-color-dark:#212529}body{background-color:#000;font-size:1rem;font-weight:400;line-height:1.5;text-align:left}</style><meta name=description content><link rel=stylesheet href=/css/index.css><link rel=stylesheet href=/css/single.css><link rel=stylesheet href=/css/projects.css media=all><script defer src=/fontawesome-5/all-5.15.4.js></script><title>Updating your google-service.json from an AppCenter environment variable | JimBobBennett</title></head><body class=light onload=loading()><header><nav class="pt-3 navbar navbar-expand-lg"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
JimBobBennett
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/ aria-label=home>Home</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Recent Highlights</a></li><li class="nav-item navbar-text"><a class=nav-link href=/blogs title="Blog posts">Blog</a></li><li class="nav-item navbar-text"><a class=nav-link href=/videos title=Videos>Videos</a></li><li class="nav-item navbar-text"><a class=nav-link href=/livestreams title=Livestreams>Livestreams</a></li><li class="nav-item navbar-text"><a class=nav-link href=/conferences title=Conferences>Conferences</a></li><li class="nav-item navbar-text"><a class=nav-link href=/resume title=Resume>Resume</a></li></ul></div></div></nav></header><div id=content><section id=projects><div class="container pt-5" id=list-page><div class="row justify-content-center px-3 px-md-5"><h1 class="text-left pb-2 content">Updating your google-service.json from an AppCenter environment variable</h1><div class="text-left content"><a href=https://linkedin.com/in/jimbobbennett>Jim Bennett
</a><small>|</small>
Sep 25, 2018</div></div></div></section><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><article class="page-content p-2"><p>I&rsquo;ve been working on an app that needs push notifications, but also needs to be open source. This led me to a problem - the <code>google-services.json</code> file. This file is needed to sign up for Firebase messaging to implement push on Android, but it also contains my API keys, values I do <strong>NOT</strong> want to be public.</p><p>So - what to do?</p><p>Well I&rsquo;m building and distributing my app using <a href="https://appcenter.ms/?WT.mc_id=appcenter-blog-jabenn">AppCenter</a> and the build configuration contains a couple of useful settings that I can take advantage of - <a href="https://docs.microsoft.com/en-gb/appcenter/build/custom/scripts/?WT.mc_id=appcenter-blog-jabenn">build scripts</a> and <a href="https://docs.microsoft.com/en-gb/appcenter/build/custom/variables/?WT.mc_id=appcenter-blog-jabenn">environment variables</a>.</p><p>I can define the contents of my <code>google-services.json</code> file inside an environment variable, add a dummy version to my GitHub repo, then overwrite the dummy one with the environment variable at build time. This means my secrets are safe, and the real value is protected using my AppCenter account. I can then also use the right version locally by excluding updates to this file from git as <a href=/blogs/hiding-api-keys-from-git/>I&rsquo;ve described before</a>.</p><p>This works not only for an open source project, but if I wanted to have different settings for different builds (such as different push end points for QA or beta builds).</p><h4 id=check-a-dummy-google-servicesjson-file-into-source-control>Check a dummy <code>google-services.json</code> file into source control</h4><p>Add the <code>google-services.json</code> file to your project as normal. Blank out the file and add it to git. Revert the blanked out file and hide updates from git using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>git update-index --assume-unchanged ./google-services.json 
</span></span></code></pre></div><p>Run this from the root of your Android app.</p><h4 id=define-the-environment-variable>Define the environment variable</h4><p>From the <strong>Build configuration</strong> tab of your build in AppCenter, turn on <strong>Environment variables</strong>. Add a new variable called <code>GOOGLE_JSON</code> and paste in the contents of your <code>google-services.json</code> file.</p><div class=image-div style=max-width:500px><p><img src=2018-09-25_14-59-02.png alt="Adding the contents of the google services json file to an environment variable"></p></div><h4 id=create-a-build-script-to-update-the-file>Create a build script to update the file</h4><p>AppCenter can run build scripts before or after the build. These scripts have to have a <a href="https://docs.microsoft.com/en-gb/appcenter/build/custom/scripts/?WT.mc_id=appcenter-blog-jabenn">specific name</a> to be picked up by the build configuration. To create a pre-build script, create a script file in the root of your repo called <code>appcenter-pre-build.sh</code>. Add the following code to this script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>GOOGLE_JSON_FILE<span style=color:#f92672>=</span>$APPCENTER_SOURCE_DIRECTORY/&lt;path&gt;/google-services.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -e <span style=color:#e6db74>&#34;</span>$GOOGLE_JSON_FILE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Updating Google Json&#34;</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$GOOGLE_JSON<span style=color:#e6db74>&#34;</span> &gt; $GOOGLE_JSON_FILE
</span></span><span style=display:flex><span>    sed -i -e <span style=color:#e6db74>&#39;s/\\&#34;/&#39;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#39;/g&#39;</span> $GOOGLE_JSON_FILE
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;File content:&#34;</span>
</span></span><span style=display:flex><span>    cat $GOOGLE_JSON_FILE
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>Update <path>to be the path to the <code>google-services.json</code> file from the root of your repo. The <code>$APPCENTER_SOURCE_DIRECTORY</code> environment variable points to where on the build VM App Center has put your code.</p><p>This code will check for the file, and if it finds it copy the value of the environment variable into this file, followed by using a <code>sed</code> command to strip out escape characters as environment variables get double quotes escaped to <code>\"</code>.</p><p>Once you add this file to your repo, it will appear under the <strong>Build Scripts</strong> in the <strong>Build Configuration</strong>.</p><div class=image-div style=max-width:500px><p><img src=2018-09-25_15-11-49.png alt="Pre-build script turned on in the build configuration"></p></div><p>If you <strong>Save and build</strong> the project, you will see the <code>google-services.json</code> file written to and dumped to the build log.</p><div class=image-div style=max-width:250px><p><img src=2018-09-25_15-13-43.png alt="Log dump showing the file being written"></p></div><hr><p>You can read more about the capabilities of <a href="https://appcenter.ms/?WT.mc_id=appcenter-blog-jabenn">AppCenter</a> on <a href="https://docs.microsoft.com/en-gb/appcenter/?WT.mc_id=appcenter-blog-jabenn">docs.com</a>.</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div class=sticky-sidebar><aside class=toc><h5>Table Of Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></aside><aside class=tags><h5>Tags</h5><ul class="tags-ul list-unstyled list-inline"><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/technology target=_blank>Technology</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/xamarin target=_blank>xamarin</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/google-play target=_blank>google play</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/appcenter target=_blank>appcenter</a></li><li class=list-inline-item><a href=https://jimbobbennett.dev/tags/firebase target=_blank>firebase</a></li></ul></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://jimbobbennett.dev/blogs/updating-your-google-service-json-from-an-appcenter-environment-variable/",this.page.identifier="7e4eafc9cd56615e5ddd242b4c060e0f"};(function(){if(window.location.hostname=="localhost")return;var e=document,t=e.createElement("script");t.src="https://jimbobbennett.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script></div><footer><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2023 All Rights Reserved</div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js integrity=sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13 crossorigin=anonymous></script><script>document.body.className.includes("light")&&(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))</script><script>let loadingIcons;function loading(){myVar=setTimeout(showPage,100)}function showPage(){try{document.getElementById("loading-icons").style.display="block"}catch{}}</script><script>function createCopyButton(e,t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy",n.addEventListener("click",()=>copyCodeToClipboard(n,e,t)),addCopyButtonToDom(n,e)}async function copyCodeToClipboard(e,t,n){const s=t.querySelector("pre > code").innerText;try{n.writeText(s)}finally{codeWasCopied(e)}}function codeWasCopied(e){e.blur(),e.innerText="Copied!",setTimeout(function(){e.innerText="Copy"},2e3)}function addCopyButtonToDom(e,t){t.insertBefore(e,t.firstChild);const n=document.createElement("div");n.className="highlight-wrapper",t.parentNode.insertBefore(n,t),n.appendChild(t)}if(navigator&&navigator.clipboard)document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,navigator.clipboard));else{var script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js",script.integrity="sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=",script.crossOrigin="anonymous",script.onload=function(){addCopyButtons(clipboard)},document.querySelectorAll(".highlight").forEach(e=>createCopyButton(e,script)),document.body.appendChild(script)}</script></body></html>